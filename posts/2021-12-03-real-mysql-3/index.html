<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>[Real MySQL 8.0] #3 사용자 및 권한 | Realsangil</title>
<meta name=keywords content="mysql,real-mysql">
<meta name=description content="Real MySQL 3장 사용자 및 권한을 보고 정리한 내용입니다.">
<meta name=author content="박상일">
<link rel=canonical href=https://blog.realsangil.net/posts/2021-12-03-real-mysql-3/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.realsangil.net/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://blog.realsangil.net/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://blog.realsangil.net/favicon-32x32.png>
<link rel=apple-touch-icon href=https://blog.realsangil.net/apple-touch-icon.png>
<link rel=mask-icon href=https://blog.realsangil.net/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.91.2">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
</noscript>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MMTYEB98J6"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-MMTYEB98J6',{anonymize_ip:!1})}</script>
<meta property="og:title" content="[Real MySQL 8.0] #3 사용자 및 권한">
<meta property="og:description" content="Real MySQL 3장 사용자 및 권한을 보고 정리한 내용입니다.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://blog.realsangil.net/posts/2021-12-03-real-mysql-3/">
<meta property="og:image" content="https://blog.realsangil.net/images/covers/real-mysql-8-0.png"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-12-03T15:34:00+09:00">
<meta property="article:modified_time" content="2021-12-03T15:34:00+09:00">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://blog.realsangil.net/images/covers/real-mysql-8-0.png">
<meta name=twitter:title content="[Real MySQL 8.0] #3 사용자 및 권한">
<meta name=twitter:description content="Real MySQL 3장 사용자 및 권한을 보고 정리한 내용입니다.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://blog.realsangil.net/posts/"},{"@type":"ListItem","position":3,"name":"[Real MySQL 8.0] #3 사용자 및 권한","item":"https://blog.realsangil.net/posts/2021-12-03-real-mysql-3/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[Real MySQL 8.0] #3 사용자 및 권한","name":"[Real MySQL 8.0] #3 사용자 및 권한","description":"Real MySQL 3장 사용자 및 권한을 보고 정리한 내용입니다.\n","keywords":["mysql","real-mysql"],"articleBody":"Real MySQL 3장 사용자 및 권한을 보고 정리한 내용입니다.\n사용자 식별 MySQL은 사용자 계정뿐 아니라 사용자의 접속 지점(클라이언트가 실행된 호스트명이나, 도메인 또는 IP 주소)도 계정의 일부가 된다. 따라서 계정을 언급할 땐 계정정보와 호스트정보를 함께 명시해야 한다.\n다음과 같은 2개의 사용자 계정이 있는 MySQL 서버가 있다.\n'svc_id'@'192.168.0.10' (이 계정의 비밀번호는 123) 'svc_id'@'%' (이 계정의 비밀번호는 abc) IP 주소가 192.168.0.10인 PC에서 서버에 접속할 때 서버는 두 계정 정보중 어떤 계정을 선택할 것인가? 권한이나 계정 정보에 대해 MySQL은 범위가 가장 작은 것을 항상 먼저 선택한다. 즉 'svc_id'@'192.168.0.10인 계정을 선택한다.\n사용자 계정 관리 내장 계정 MySQL 서버에는 다음과 같이 내장된 계정들이 있는데 ‘root’@‘localhost’를 제외한 3개의 계정은 내부적으로 각기 다른 목적으로 사용되므로 삭제되지 않도록 주의하자.\n ‘mysql.sys’@‘localhost’: 8.0부터 기본 내장된 sys 스키마의 객체(뷰, 함수, 프로시저)들의 DEFINER로 사용되는 계정이다. ‘mysql.session’@‘localhost’: MySQL 플러그인이 서버로 접근할 때 사용되는 계정 ‘mysql.infoschema’@‘localhost’: information_schema에 정의된 뷰의 DEFINER로 사용되는 계정  3개의 계정은 처음부터 잠겨 있는 상태이므로 의도적으로 잠긴 계정을 풀지 않는 한 악의적으로 사용할 수 없다.\n계정 생성 MySQL 8.0 버전부터는 계정의 생성은 CREATE USER 명령으로, 권한 부여는 GRANT 명령으로 구분해서 실행하도록 바뀌었다.\nCREATE USER 'user'@'%' IDENTIFIED WITH 'mysql_native_password' BY 'password' REQUIRED NONE PASSWORD EXPIRE INTERVAL 30 DAY ACCOUNT UNLOCK PASSWORD HISTORY DEFAULT PASSWORD REUSE INTERVAL DEFAULT PASSWORD REQUIRE CURRENT DEFAULT; IDENTIFIED WITH 사용자의 인증 방식과 비밀번호를 설정한다.\n Native Pluggable Authentication: 단순히 비밀번호에 대한 해시(SHA-1) 값이 일치하는지 비교하는 방식 Caching SHA-2 Pluggable Authentication  8.0부터 default로 지정된 인증 방식 내부적으로 salt 키를 활용하여 수천 번의 해시 계산을 수행하여 결과를 만들어 내며 매번 결과가 달라진다. 수천 번의 해시 계산 때문에 성능이 매우 떨어지는 걸 보완하기 위해 결과값을 메모리에 캐시해서 사용한다. 이 인증 방식을 사용하려면 SSL/TLS 또는 RSA 키 페어를 반드시 사용해야 하기 때문에 클라이언트에서 접속할 때 SSL 옵션을 활성화 해야한다.    보안 수준은 좀 낮아지겠지만 기존 버전과의 호환성을 고려한다면 Caching SHA-2 Pluggable Authentication보다는 Native Authentication 방식으로 계정을 생성해야 할 수도 있다.\n SCAM(Salted Chellege Response Authentication Mechanism) 인증 방식은 평문 비밀번호를 5000번 이상 암호화 해시 함수를 실행해야 MySQL 서버로 로그인 요청을 보낼 수 있기 때문에 무작위로 비밀번호를 입력하는 무차별 대입 공격을 어렵게 만든다. 하지만 응용 프로그램에서 한번에 많은 커넥션을 연결하는 경우에는 여전히 응용 프로그램 서버의 CPU 자원을 많이 소모하게 된다는 것을 기억하자.\n REQUIRE MySQL 서버에 접속할 때 암호화된 SSL/TLS 채널을 사용할지 여부를 설정한다.\nPASSWORD EXPIRE 비밀번호의 유효 기간을 설정하는 옵션\n PASSWORD EXPIRE DEFAULT: default_password_lifetime 시스템 변수에 저장된 값을 사용하여 비밀번호 유효 기간을 설정한다. PASSWORD EXPIRE: 계정의 생성과 동시에 비밀번호를 만료 처리 PASSWORD EXPIRE NEVER: 비밀번호의 만료 기간 없음 PASSWORD EXPIRE INTERVAL n DAY: 비밀번호 유효 기간을 n일자로 설정  PASSWORD HISTORY 한 번 사용했던 비밀번호를 재사용하지 못하게 설정하는 옵션\n PASSWORD HISTORY DEFAULT: password_history 시스템 변수에 저장된 개수만큼 비밀번호의 이력을 저장하며, 저장된 이력이 있는 비밀번호는 재사용할 수 없다. PASSWORD HISTORY n: 비밀번호 이력을 최근 n개까지만 저장하며, 저장된 이력에 남아 있는 비밀번호는 재사용할 수 없다.  PASSWORD REUSE INTERVAL 한 번 사용했던 비밀번호의 재사용 금지 기간을 설정하는 옵션\n PASSWORD REUSE INTERVAL DEFAULT:password_reuse_interval 변수에 저장된 기간으로 설정 PASSWORD REUSE INTERVAL n: n일자 이후에 비밀번호를 재사용 할 수 있게 설정  PASSWORD REQUIRE 비밀번호가 만료되어 새로운 비밀번호로 변경할 때 현재 비밀번호(만료된 비밀번호)를 필요로 할지 말지를 결정하는 옵션\n PASSWORD REQUIRE DEFAULT: password_require_current 시스템 변수의 값으로 설정 PASSWORD REQUIRE CURRENT: 비밀번호를 변경할 때 현재 비밀번호를 먼저 입력하도록 설정 PASSWORD REQUIRE OPTIONAL: 비밀번호를 변경할 때 현재 비밀번호를 입력하지 않아도 되도록 설정  ACCOUNT LOCK / UNLOCK 계정을 사용하지 못하게 잠글지 여부를 결정\n ACCOUNT LOCK: 계정을 사용하지 못하게 잠금 ACCOUNT UNLOCK: 잠긴 계정을 다시 사용 가능 상태로 잠금 해제  비밀번호 관리 고수준 비밀번호 비밀번호의 글자 조합을 강제하거나 금칙어를 설정하는 기능도 있다. MySQL 서버에서 유효성 체크 규칙을 적용하려면 기본적으로 내장된 validate_password 컴포넌트를 이용하면 된다.\n-- validate_password 컴포넌트 설치 INSTALL 'file://component_validate_password' -- 설치된 컴포넌트 확인 SELECT * FROM mysql.component; -- 컴포넌트에서 제공하는 시스템 변수 확인 SHOW GLOBAL VARIABLES LIKE 'validate_password%'; validate_password 컴포넌트에서 제공하는 시스템 변수의 정보는 링크에서 확인 가능하다.\n비밀번호 번호 정책\n LOW: 비밀번호의 길이만 검증 MEDIUM: DEFAULT, 비밀번호의 길이와 문자(숫자, 대소문자, 특수문자)의 배합을 검증 STRONG: MEDIUM 레벨의 검증을 모두 수행하며, 금칙어가 포함 여부까지 검증  이중 비밀번호 (Dual Password)  이중 비밀번호는 2개의 비밀번호 중 하나만 일치하면 로그인이 통과되는 것을 의미한다.\n 이미 서비스 중인 데이터베이스의 계정 정보는 쉽게 변경하기 어렵기 때문에 서비스 기간동안 비밀번호를 한번도 수정하지 못하는 경우가 많다. 이와 같은 문제점을 해결하기 위해 MySQL 8.0 버전부터는 동시에 2개의 비밀번호를 계정에 설정할 수 있는 기능이 추가되었다.\n2개의 비밀번호를 설정하는 방법은 비밀번호 변경 구문에 RETAIN CURRENT PASSWORD 옵션만 추가하면 된다.\n-- 기존 비밀번호 변경 구문 ALTER USER 'root'@'localhost' IDENTIFIED BY 'old_password'; 위 명령어는 root 계정의 프라이머리 비밀번호는 old_password로 변경되고 세컨더리 비밀번호는 빈 상태가 된다.\n-- dual password 설정 ALTER USER 'root'@'localhost' IDENTIFIED BY 'new_password' RETAIN CURRENT PASSWORD; 위 명령어는 root 계정의 프라이머리 비밀번호를 new_password로 지정하고 세컨더리 비밀번호를 old_password로 변경한다.\n모든 서비스가 재배포 되었다면 보안을 위해 세컨더리 비밀번호를 삭제하는 걸 추천한다.\n권한 MySQL 8.0부터 정적 권한(기존 권한)과 동적 권한의 개념이 추가 되었다.\n 정적 권한은 MySQL 서버의 소스코드에 고정적으로 명시돼 있는 권한을 의미한다.  글로벌 권한: 데이터베이스나 테이블 이외의 객체에 적용되는 권한 객체 권한: 데이터베이스나 테이블을 제어하는 데 필요한 권한   동적 권한은 MySQL 서버가 시작되면서 동적으로 생성하는 권한을 의미한다.  MySQL 8.0부터는 SUPER 권한이 잘게 쪼게어졌다. 링크를 통해 자세하게 확인 가능하다.\n8.0부터 존재하지 않는 사용자에 GRANT 명령어를 실행하면 에러가 발생하기 때문에 권한을 부여하기 전에 사용자를 반드시 생성해야 한다.\n권한은 GRANT 명령어를 사용하여 사용자에게 부여할 수 있다.\n-- example GRANT previlege1, previlege2, previlege3 ON db.table TO 'user'@'host'; -- 글로벌 권한 -- 글로벌 권한은 객체에 부여할 수 없기 때문에 항상 *.*을 사용한다. GRANT SUPER ON *.* 'user'@'localhost'; -- DB 권한 -- DB 권한은 모든 DB와 특정 DB에 권한을 부여할 수 있기 때문에 *.*이나 employees.*를 모두 사용할 수 있다. GRANT EVENT ON *.* TO 'user'@'localhost'; GRANT EVENT ON employees.* TO 'user'@'localhost'; -- 테이블 권한 -- DB 권한은 모든 테이블 및 특정 테이블에 권한을 부여할 수 있기 때문에 *.*이나 employees.*, employees.department를 모두 사용할 수 있다. GRANT SELECT,INSERT,UPDATE,DELETE ON *.* TO 'user'@'localhost'; GRANT SELECT,INSERT,UPDATE,DELETE ON employees.* TO 'user'@'localhost'; GRANT SELECT,INSERT,UPDATE,DELETE ON employees.department TO 'user'@'localhost'; 칼럼 단위에도 권한을 부여할 수 있지만 칼럼 단위의 권한이 하나라도 설정되면 나머지 모든 테이블의 모든 칼럼에 대해서도 권한을 체크하기 때문에 전체적인 성능에 영향을 미칠수 있어 잘 사용하지 않는다.\n역할 (Role) 역할 생성 MySQL 8.0 버전부터 권한을 묶어서 역할을 사용할 수 있게 됐다. 역할은 CREATE ROLE 명령을 이용해서 정의할 수 있다. 처음 역할을 생성하면 아무 권한이 존재하지 않지만 GRANT 명령으로 역할을 부여하면 된다.\nCREATE USER reader@'127.0.0.1' IDENTIFIED BY '1234'; Query OK, 0 rows affected (0.02 sec) CREATE USER 'writer'@'127.0.0.1' IDENTIFIED BY '1234'; Query OK, 0 rows affected (0.01 sec) CREATE ROLE role_emp_read, role_emp_write; Query OK, 0 rows affected (0.02 sec) SELECT user, host, account_locked FROM mysql.user; +------------------+-----------+----------------+ | user | host | account_locked | +------------------+-----------+----------------+ | role_emp_read | % | Y | | role_emp_write | % | Y | | role_read | % | Y | | role_write | % | Y | | root | % | N | | mysql.infoschema | localhost | Y | | mysql.session | localhost | Y | | mysql.sys | localhost | Y | | root | localhost | N | +------------------+-----------+----------------+ 11 rows in set (0.00 sec) GRANT SELECT ON employees.* TO role_emp_read; Query OK, 0 rows affected (0.01 sec) GRANT INSERT, UPDATE, DELETE ON employees.* TO role_emp_write; Query OK, 0 rows affected (0.01 sec) GRANT role_emp_read TO reader@127.0.0.1; Query OK, 0 rows affected (0.01 sec) GRANT role_emp_write TO writer@127.0.0.1; Query OK, 0 rows affected (0.01 sec) 계정에 역할 부여 계정 로그인 후 SET ROLE 명령을 통해 역할을 활성화 해줘야 한다.\n이 작업이 번거로우면 activate_all_roles 시스템 변수의 값을 ON으로 업데이트하면 로그인 시 역할이 자동으로 활성화 된다.\nSHOW GRANTS; +---------------------------------------------------+ | Grants for reader@127.0.0.1 | +---------------------------------------------------+ | GRANT USAGE ON *.* TO `reader`@`127.0.0.1` | | GRANT `role_emp_read`@`%` TO `reader`@`127.0.0.1` | +---------------------------------------------------+ 2 rows in set (0.00 sec) SHOW GRANTS; +----------------------------------------------------+ | Grants for writer@127.0.0.1 | +----------------------------------------------------+ | GRANT USAGE ON *.* TO `writer`@`127.0.0.1` | | GRANT `role_emp_write`@`%` TO `writer`@`127.0.0.1` | +----------------------------------------------------+ 2 rows in set (0.00 sec) SELECT current_role(); +----------------+ | current_role() | +----------------+ | NONE | +----------------+ 1 row in set (0.00 sec) SET ROLE role_emp_write; Query OK, 0 rows affected (0.00 sec) SELECT current_role(); +----------------------+ | current_role() | +----------------------+ | `role_emp_write`@`%` | +----------------------+ 1 row in set (0.00 sec) SELECT user, host, account_locked FROM mysql.user; +------------------+-----------+----------------+ | user | host | account_locked | +------------------+-----------+----------------+ | role_emp_read | % | Y | | role_emp_write | % | Y | | role_read | % | Y | | role_write | % | Y | | root | % | N | | reader | 127.0.0.1 | N | | writer | 127.0.0.1 | N | | mysql.infoschema | localhost | Y | | mysql.session | localhost | Y | | mysql.sys | localhost | Y | | root | localhost | N | +------------------+-----------+----------------+ 11 rows in set (0.00 sec) 역할과 계정의 차이  서버 내부적으로 역할과 계정은 아무런 차이가 없다. CREATE ROLE 명령으로 생성된 역할은 account_locked 컬럼이 Y로 설정되어 로그인할 수 없도록 생성된다. 역할의 호스트 부분은 역할을 다른 계정에 부여하지 않고 직접 로그인할 때에만 의미가 있고 역할 상태에서는 아무런 영향이 없다. 역할과 계정은 실제로 DB에서도 구분하기 힘들기 때문에 role_과 같은 prefix를 붙여 구분할 수 있도록 하는 것이 좋다.  구매 링크: http://www.yes24.com/Product/Goods/103415627\n","wordCount":"1469","inLanguage":"en","image":"https://blog.realsangil.net/images/covers/real-mysql-8-0.png","datePublished":"2021-12-03T15:34:00+09:00","dateModified":"2021-12-03T15:34:00+09:00","author":{"@type":"Person","name":"박상일"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.realsangil.net/posts/2021-12-03-real-mysql-3/"},"publisher":{"@type":"Organization","name":"Realsangil","logo":{"@type":"ImageObject","url":"https://blog.realsangil.net/favicon.ico"}}}</script>
</head>
<body id=top>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://blog.realsangil.net accesskey=h title="Realsangil (Alt + H)">Realsangil</a>
<span class=logo-switches>
</span>
</div>
<ul id=menu>
<li>
<a href=https://blog.realsangil.net/posts/ title=posts>
<span>posts</span>
</a>
</li>
<li>
<a href=https://blog.realsangil.net/tags/ title=tags>
<span>tags</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://blog.realsangil.net>Home</a>&nbsp;»&nbsp;<a href=https://blog.realsangil.net/posts/>Posts</a></div>
<h1 class=post-title>
[Real MySQL 8.0] #3 사용자 및 권한
</h1>
<div class=post-meta><span title="2021-12-03 15:34:00 +0900 +0900">December 3, 2021</span>&nbsp;·&nbsp;7 min&nbsp;·&nbsp;박상일
</div>
</header>
<figure class=entry-cover><img loading=lazy src=https://blog.realsangil.net/images/covers/real-mysql-8-0.png alt>
</figure><div class=toc>
<details open>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><ul>
<li>
<a href=#%ec%82%ac%ec%9a%a9%ec%9e%90-%ec%8b%9d%eb%b3%84 aria-label="사용자 식별">사용자 식별</a></li>
<li>
<a href=#%ec%82%ac%ec%9a%a9%ec%9e%90-%ea%b3%84%ec%a0%95-%ea%b4%80%eb%a6%ac aria-label="사용자 계정 관리">사용자 계정 관리</a><ul>
<li>
<a href=#%eb%82%b4%ec%9e%a5-%ea%b3%84%ec%a0%95 aria-label="내장 계정">내장 계정</a></li>
<li>
<a href=#%ea%b3%84%ec%a0%95-%ec%83%9d%ec%84%b1 aria-label="계정 생성">계정 생성</a><ul>
<li>
<a href=#identified-with aria-label="IDENTIFIED WITH">IDENTIFIED WITH</a></li>
<li>
<a href=#require aria-label=REQUIRE>REQUIRE</a></li>
<li>
<a href=#password-expire aria-label="PASSWORD EXPIRE">PASSWORD EXPIRE</a></li>
<li>
<a href=#password-history aria-label="PASSWORD HISTORY">PASSWORD HISTORY</a></li>
<li>
<a href=#password-reuse-interval aria-label="PASSWORD REUSE INTERVAL">PASSWORD REUSE INTERVAL</a></li>
<li>
<a href=#password-require aria-label="PASSWORD REQUIRE">PASSWORD REQUIRE</a></li>
<li>
<a href=#account-lock--unlock aria-label="ACCOUNT LOCK / UNLOCK">ACCOUNT LOCK / UNLOCK</a></li></ul>
</li></ul>
</li>
<li>
<a href=#%eb%b9%84%eb%b0%80%eb%b2%88%ed%98%b8-%ea%b4%80%eb%a6%ac aria-label="비밀번호 관리">비밀번호 관리</a><ul>
<li>
<a href=#%ea%b3%a0%ec%88%98%ec%a4%80-%eb%b9%84%eb%b0%80%eb%b2%88%ed%98%b8 aria-label="고수준 비밀번호">고수준 비밀번호</a></li>
<li>
<a href=#%ec%9d%b4%ec%a4%91-%eb%b9%84%eb%b0%80%eb%b2%88%ed%98%b8-dual-password aria-label="이중 비밀번호 (Dual Password)">이중 비밀번호 (Dual Password)</a></li></ul>
</li>
<li>
<a href=#%ea%b6%8c%ed%95%9c aria-label=권한>권한</a></li>
<li>
<a href=#%ec%97%ad%ed%95%a0-role aria-label="역할 (Role)">역할 (Role)</a><ul>
<li>
<a href=#%ec%97%ad%ed%95%a0-%ec%83%9d%ec%84%b1 aria-label="역할 생성">역할 생성</a></li>
<li>
<a href=#%ea%b3%84%ec%a0%95%ec%97%90-%ec%97%ad%ed%95%a0-%eb%b6%80%ec%97%ac aria-label="계정에 역할 부여">계정에 역할 부여</a></li>
<li>
<a href=#%ec%97%ad%ed%95%a0%ea%b3%bc-%ea%b3%84%ec%a0%95%ec%9d%98-%ec%b0%a8%ec%9d%b4 aria-label="역할과 계정의 차이">역할과 계정의 차이</a>
</li>
</ul>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><p>Real MySQL 3장 사용자 및 권한을 보고 정리한 내용입니다.</p>
<h2 id=사용자-식별>사용자 식별<a hidden class=anchor aria-hidden=true href=#사용자-식별>#</a></h2>
<p>MySQL은 사용자 계정뿐 아니라 사용자의 접속 지점(클라이언트가 실행된 호스트명이나, 도메인 또는 IP 주소)도 계정의 일부가 된다. 따라서 계정을 언급할 땐 계정정보와 호스트정보를 함께 명시해야 한다.</p>
<p>다음과 같은 2개의 사용자 계정이 있는 MySQL 서버가 있다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#e6db74>&#39;svc_id&#39;</span><span style=color:#f92672>@</span><span style=color:#e6db74>&#39;192.168.0.10&#39;</span> (<span style=color:#960050;background-color:#1e0010>이</span> <span style=color:#960050;background-color:#1e0010>계정의</span> <span style=color:#960050;background-color:#1e0010>비밀번호는</span> <span style=color:#ae81ff>123</span>)
<span style=color:#e6db74>&#39;svc_id&#39;</span><span style=color:#f92672>@</span><span style=color:#e6db74>&#39;%&#39;</span> (<span style=color:#960050;background-color:#1e0010>이</span> <span style=color:#960050;background-color:#1e0010>계정의</span> <span style=color:#960050;background-color:#1e0010>비밀번호는</span> abc)
</code></pre></div><p>IP 주소가 <code>192.168.0.10</code>인 PC에서 서버에 접속할 때 서버는 두 계정 정보중 어떤 계정을 선택할 것인가? 권한이나 계정 정보에 대해 MySQL은 <strong>범위가 가장 작은 것</strong>을 항상 먼저 선택한다.
즉 <code>'svc_id'@'192.168.0.10</code>인 계정을 선택한다.</p>
<h2 id=사용자-계정-관리>사용자 계정 관리<a hidden class=anchor aria-hidden=true href=#사용자-계정-관리>#</a></h2>
<h3 id=내장-계정>내장 계정<a hidden class=anchor aria-hidden=true href=#내장-계정>#</a></h3>
<p>MySQL 서버에는 다음과 같이 내장된 계정들이 있는데 &lsquo;root&rsquo;@&lsquo;localhost&rsquo;를 제외한 3개의 계정은 내부적으로 각기 다른 목적으로 사용되므로 삭제되지 않도록 주의하자.</p>
<ul>
<li>&lsquo;mysql.sys&rsquo;@&lsquo;localhost&rsquo;: 8.0부터 기본 내장된 sys 스키마의 객체(뷰, 함수, 프로시저)들의 DEFINER로 사용되는 계정이다.</li>
<li>&lsquo;mysql.session&rsquo;@&lsquo;localhost&rsquo;: MySQL 플러그인이 서버로 접근할 때 사용되는 계정</li>
<li>&lsquo;mysql.infoschema&rsquo;@&lsquo;localhost&rsquo;: <code>information_schema</code>에 정의된 뷰의 DEFINER로 사용되는 계정</li>
</ul>
<p>3개의 계정은 처음부터 잠겨 있는 상태이므로 의도적으로 잠긴 계정을 풀지 않는 한 악의적으로 사용할 수 없다.</p>
<h3 id=계정-생성>계정 생성<a hidden class=anchor aria-hidden=true href=#계정-생성>#</a></h3>
<p>MySQL 8.0 버전부터는 계정의 생성은 <code>CREATE USER</code> 명령으로, 권한 부여는 <code>GRANT</code> 명령으로 구분해서 실행하도록 바뀌었다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>USER</span> <span style=color:#e6db74>&#39;user&#39;</span><span style=color:#f92672>@</span><span style=color:#e6db74>&#39;%&#39;</span>
    <span style=color:#66d9ef>IDENTIFIED</span> <span style=color:#66d9ef>WITH</span> <span style=color:#e6db74>&#39;mysql_native_password&#39;</span> <span style=color:#66d9ef>BY</span> <span style=color:#e6db74>&#39;password&#39;</span>
    REQUIRED NONE
    PASSWORD EXPIRE <span style=color:#66d9ef>INTERVAL</span> <span style=color:#ae81ff>30</span> DAY
    ACCOUNT <span style=color:#66d9ef>UNLOCK</span>
    PASSWORD HISTORY <span style=color:#66d9ef>DEFAULT</span>
    PASSWORD REUSE <span style=color:#66d9ef>INTERVAL</span> <span style=color:#66d9ef>DEFAULT</span>
    PASSWORD <span style=color:#66d9ef>REQUIRE</span> CURRENT <span style=color:#66d9ef>DEFAULT</span>;
</code></pre></div><h4 id=identified-with>IDENTIFIED WITH<a hidden class=anchor aria-hidden=true href=#identified-with>#</a></h4>
<p>사용자의 인증 방식과 비밀번호를 설정한다.</p>
<ul>
<li>Native Pluggable Authentication: 단순히 비밀번호에 대한 해시(SHA-1) 값이 일치하는지 비교하는 방식</li>
<li>Caching SHA-2 Pluggable Authentication
<ul>
<li>8.0부터 <em>default</em>로 지정된 인증 방식</li>
<li>내부적으로 salt 키를 활용하여 수천 번의 해시 계산을 수행하여 결과를 만들어 내며 매번 결과가 달라진다.</li>
<li>수천 번의 해시 계산 때문에 성능이 매우 떨어지는 걸 보완하기 위해 결과값을 메모리에 캐시해서 사용한다.</li>
<li>이 인증 방식을 사용하려면 SSL/TLS 또는 RSA 키 페어를 반드시 사용해야 하기 때문에 클라이언트에서 접속할 때 SSL 옵션을 활성화 해야한다.</li>
</ul>
</li>
</ul>
<p>보안 수준은 좀 낮아지겠지만 기존 버전과의 호환성을 고려한다면 <code>Caching SHA-2 Pluggable Authentication</code>보다는 <code>Native Authentication</code> 방식으로 계정을 생성해야 할 수도 있다.</p>
<blockquote>
<p>SCAM(Salted Chellege Response Authentication Mechanism) 인증 방식은 평문 비밀번호를 5000번 이상 암호화 해시 함수를 실행해야 MySQL 서버로 로그인 요청을 보낼 수 있기 때문에 무작위로 비밀번호를 입력하는 무차별 대입 공격을 어렵게 만든다.
하지만 응용 프로그램에서 한번에 많은 커넥션을 연결하는 경우에는 여전히 응용 프로그램 서버의 CPU 자원을 많이 소모하게 된다는 것을 기억하자.</p>
</blockquote>
<h4 id=require>REQUIRE<a hidden class=anchor aria-hidden=true href=#require>#</a></h4>
<p>MySQL 서버에 접속할 때 암호화된 SSL/TLS 채널을 사용할지 여부를 설정한다.</p>
<h4 id=password-expire>PASSWORD EXPIRE<a hidden class=anchor aria-hidden=true href=#password-expire>#</a></h4>
<p>비밀번호의 유효 기간을 설정하는 옵션</p>
<ul>
<li>PASSWORD EXPIRE DEFAULT: <code>default_password_lifetime</code> 시스템 변수에 저장된 값을 사용하여 비밀번호 유효 기간을 설정한다.</li>
<li>PASSWORD EXPIRE: 계정의 생성과 동시에 비밀번호를 만료 처리</li>
<li>PASSWORD EXPIRE NEVER: 비밀번호의 만료 기간 없음</li>
<li>PASSWORD EXPIRE INTERVAL <code>n</code> DAY: 비밀번호 유효 기간을 <code>n</code>일자로 설정</li>
</ul>
<h4 id=password-history>PASSWORD HISTORY<a hidden class=anchor aria-hidden=true href=#password-history>#</a></h4>
<p>한 번 사용했던 비밀번호를 재사용하지 못하게 설정하는 옵션</p>
<ul>
<li>PASSWORD HISTORY DEFAULT: <code>password_history</code> 시스템 변수에 저장된 개수만큼 비밀번호의 이력을 저장하며, 저장된 이력이 있는 비밀번호는 재사용할 수 없다.</li>
<li>PASSWORD HISTORY n: 비밀번호 이력을 최근 <code>n</code>개까지만 저장하며, 저장된 이력에 남아 있는 비밀번호는 재사용할 수 없다.</li>
</ul>
<h4 id=password-reuse-interval>PASSWORD REUSE INTERVAL<a hidden class=anchor aria-hidden=true href=#password-reuse-interval>#</a></h4>
<p>한 번 사용했던 비밀번호의 재사용 금지 기간을 설정하는 옵션</p>
<ul>
<li>PASSWORD REUSE INTERVAL DEFAULT:<code>password_reuse_interval</code> 변수에 저장된 기간으로 설정</li>
<li>PASSWORD REUSE INTERVAL <code>n</code>: <code>n</code>일자 이후에 비밀번호를 재사용 할 수 있게 설정</li>
</ul>
<h4 id=password-require>PASSWORD REQUIRE<a hidden class=anchor aria-hidden=true href=#password-require>#</a></h4>
<p>비밀번호가 만료되어 새로운 비밀번호로 변경할 때 현재 비밀번호(만료된 비밀번호)를 필요로 할지 말지를 결정하는 옵션</p>
<ul>
<li>PASSWORD REQUIRE DEFAULT: <code>password_require_current</code> 시스템 변수의 값으로 설정</li>
<li>PASSWORD REQUIRE CURRENT: 비밀번호를 변경할 때 현재 비밀번호를 먼저 입력하도록 설정</li>
<li>PASSWORD REQUIRE OPTIONAL: 비밀번호를 변경할 때 현재 비밀번호를 입력하지 않아도 되도록 설정</li>
</ul>
<h4 id=account-lock--unlock>ACCOUNT LOCK / UNLOCK<a hidden class=anchor aria-hidden=true href=#account-lock--unlock>#</a></h4>
<p>계정을 사용하지 못하게 잠글지 여부를 결정</p>
<ul>
<li>ACCOUNT LOCK: 계정을 사용하지 못하게 잠금</li>
<li>ACCOUNT UNLOCK: 잠긴 계정을 다시 사용 가능 상태로 잠금 해제</li>
</ul>
<h2 id=비밀번호-관리>비밀번호 관리<a hidden class=anchor aria-hidden=true href=#비밀번호-관리>#</a></h2>
<h3 id=고수준-비밀번호>고수준 비밀번호<a hidden class=anchor aria-hidden=true href=#고수준-비밀번호>#</a></h3>
<p>비밀번호의 글자 조합을 강제하거나 금칙어를 설정하는 기능도 있다. MySQL 서버에서 유효성 체크 규칙을 적용하려면 기본적으로 내장된 <code>validate_password</code> 컴포넌트를 이용하면 된다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#75715e>-- validate_password 컴포넌트 설치
</span><span style=color:#75715e></span>INSTALL <span style=color:#e6db74>&#39;file://component_validate_password&#39;</span>

<span style=color:#75715e>-- 설치된 컴포넌트 확인
</span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> mysql.component;

<span style=color:#75715e>-- 컴포넌트에서 제공하는 시스템 변수 확인
</span><span style=color:#75715e></span><span style=color:#66d9ef>SHOW</span> GLOBAL VARIABLES <span style=color:#66d9ef>LIKE</span> <span style=color:#e6db74>&#39;validate_password%&#39;</span>;
</code></pre></div><p><code>validate_password</code> 컴포넌트에서 제공하는 시스템 변수의 정보는 <a href=https://dev.mysql.com/doc/refman/8.0/en/validate-password-options-variables.html>링크</a>에서 확인 가능하다.</p>
<p>비밀번호 번호 정책</p>
<ul>
<li>LOW: 비밀번호의 길이만 검증</li>
<li>MEDIUM: <em>DEFAULT</em>, 비밀번호의 길이와 문자(숫자, 대소문자, 특수문자)의 배합을 검증</li>
<li>STRONG: MEDIUM 레벨의 검증을 모두 수행하며, 금칙어가 포함 여부까지 검증</li>
</ul>
<h3 id=이중-비밀번호-dual-password>이중 비밀번호 (Dual Password)<a hidden class=anchor aria-hidden=true href=#이중-비밀번호-dual-password>#</a></h3>
<blockquote>
<p>이중 비밀번호는 2개의 비밀번호 중 하나만 일치하면 로그인이 통과되는 것을 의미한다.</p>
</blockquote>
<p>이미 서비스 중인 데이터베이스의 계정 정보는 쉽게 변경하기 어렵기 때문에 서비스 기간동안 비밀번호를 한번도 수정하지 못하는 경우가 많다.
이와 같은 문제점을 해결하기 위해 MySQL 8.0 버전부터는 <u>동시에 2개의 비밀번호를 계정에 설정할 수 있는 기능</u>이 추가되었다.</p>
<p>2개의 비밀번호를 설정하는 방법은 비밀번호 변경 구문에 <code>RETAIN CURRENT PASSWORD</code> 옵션만 추가하면 된다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#75715e>-- 기존 비밀번호 변경 구문
</span><span style=color:#75715e></span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>USER</span> <span style=color:#e6db74>&#39;root&#39;</span><span style=color:#f92672>@</span><span style=color:#e6db74>&#39;localhost&#39;</span> <span style=color:#66d9ef>IDENTIFIED</span> <span style=color:#66d9ef>BY</span> <span style=color:#e6db74>&#39;old_password&#39;</span>;
</code></pre></div><p>위 명령어는 root 계정의 프라이머리 비밀번호는 <code>old_password</code>로 변경되고 세컨더리 비밀번호는 빈 상태가 된다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#75715e>-- dual password 설정
</span><span style=color:#75715e></span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>USER</span> <span style=color:#e6db74>&#39;root&#39;</span><span style=color:#f92672>@</span><span style=color:#e6db74>&#39;localhost&#39;</span> <span style=color:#66d9ef>IDENTIFIED</span> <span style=color:#66d9ef>BY</span> <span style=color:#e6db74>&#39;new_password&#39;</span> RETAIN CURRENT PASSWORD;
</code></pre></div><p>위 명령어는 root 계정의 프라이머리 비밀번호를 <code>new_password</code>로 지정하고 세컨더리 비밀번호를 <code>old_password</code>로 변경한다.</p>
<p>모든 서비스가 재배포 되었다면 보안을 위해 세컨더리 비밀번호를 삭제하는 걸 추천한다.</p>
<h2 id=권한>권한<a hidden class=anchor aria-hidden=true href=#권한>#</a></h2>
<p>MySQL 8.0부터 정적 권한(기존 권한)과 동적 권한의 개념이 추가 되었다.</p>
<ul>
<li>정적 권한은 MySQL 서버의 소스코드에 고정적으로 명시돼 있는 권한을 의미한다.
<ul>
<li>글로벌 권한: 데이터베이스나 테이블 이외의 객체에 적용되는 권한</li>
<li>객체 권한: 데이터베이스나 테이블을 제어하는 데 필요한 권한</li>
</ul>
</li>
<li>동적 권한은 MySQL 서버가 시작되면서 동적으로 생성하는 권한을 의미한다.</li>
</ul>
<p>MySQL 8.0부터는 SUPER 권한이 잘게 쪼게어졌다. <a href=https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_super>링크</a>를 통해 자세하게 확인 가능하다.</p>
<p>8.0부터 존재하지 않는 사용자에 <code>GRANT</code> 명령어를 실행하면 에러가 발생하기 때문에 권한을 부여하기 전에 사용자를 반드시 생성해야 한다.</p>
<p>권한은 <code>GRANT</code> 명령어를 사용하여 사용자에게 부여할 수 있다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#75715e>-- example
</span><span style=color:#75715e></span><span style=color:#66d9ef>GRANT</span> previlege1, previlege2, previlege3 <span style=color:#66d9ef>ON</span> db.<span style=color:#66d9ef>table</span> <span style=color:#66d9ef>TO</span> <span style=color:#e6db74>&#39;user&#39;</span><span style=color:#f92672>@</span><span style=color:#e6db74>&#39;host&#39;</span>;

<span style=color:#75715e>-- 글로벌 권한
</span><span style=color:#75715e>-- 글로벌 권한은 객체에 부여할 수 없기 때문에 항상 *.*을 사용한다.
</span><span style=color:#75715e></span><span style=color:#66d9ef>GRANT</span> SUPER <span style=color:#66d9ef>ON</span> <span style=color:#f92672>*</span>.<span style=color:#f92672>*</span> <span style=color:#e6db74>&#39;user&#39;</span><span style=color:#f92672>@</span><span style=color:#e6db74>&#39;localhost&#39;</span>;

<span style=color:#75715e>-- DB 권한
</span><span style=color:#75715e>-- DB 권한은 모든 DB와 특정 DB에 권한을 부여할 수 있기 때문에 *.*이나 employees.*를 모두 사용할 수 있다.
</span><span style=color:#75715e></span><span style=color:#66d9ef>GRANT</span> EVENT <span style=color:#66d9ef>ON</span> <span style=color:#f92672>*</span>.<span style=color:#f92672>*</span> <span style=color:#66d9ef>TO</span> <span style=color:#e6db74>&#39;user&#39;</span><span style=color:#f92672>@</span><span style=color:#e6db74>&#39;localhost&#39;</span>;
<span style=color:#66d9ef>GRANT</span> EVENT <span style=color:#66d9ef>ON</span> employees.<span style=color:#f92672>*</span> <span style=color:#66d9ef>TO</span> <span style=color:#e6db74>&#39;user&#39;</span><span style=color:#f92672>@</span><span style=color:#e6db74>&#39;localhost&#39;</span>;

<span style=color:#75715e>-- 테이블 권한
</span><span style=color:#75715e>-- DB 권한은 모든 테이블 및 특정 테이블에 권한을 부여할 수 있기 때문에 *.*이나 employees.*, employees.department를 모두 사용할 수 있다.
</span><span style=color:#75715e></span><span style=color:#66d9ef>GRANT</span> <span style=color:#66d9ef>SELECT</span>,<span style=color:#66d9ef>INSERT</span>,<span style=color:#66d9ef>UPDATE</span>,<span style=color:#66d9ef>DELETE</span> <span style=color:#66d9ef>ON</span> <span style=color:#f92672>*</span>.<span style=color:#f92672>*</span> <span style=color:#66d9ef>TO</span> <span style=color:#e6db74>&#39;user&#39;</span><span style=color:#f92672>@</span><span style=color:#e6db74>&#39;localhost&#39;</span>;
<span style=color:#66d9ef>GRANT</span> <span style=color:#66d9ef>SELECT</span>,<span style=color:#66d9ef>INSERT</span>,<span style=color:#66d9ef>UPDATE</span>,<span style=color:#66d9ef>DELETE</span> <span style=color:#66d9ef>ON</span> employees.<span style=color:#f92672>*</span> <span style=color:#66d9ef>TO</span> <span style=color:#e6db74>&#39;user&#39;</span><span style=color:#f92672>@</span><span style=color:#e6db74>&#39;localhost&#39;</span>;
<span style=color:#66d9ef>GRANT</span> <span style=color:#66d9ef>SELECT</span>,<span style=color:#66d9ef>INSERT</span>,<span style=color:#66d9ef>UPDATE</span>,<span style=color:#66d9ef>DELETE</span> <span style=color:#66d9ef>ON</span> employees.department <span style=color:#66d9ef>TO</span> <span style=color:#e6db74>&#39;user&#39;</span><span style=color:#f92672>@</span><span style=color:#e6db74>&#39;localhost&#39;</span>;
</code></pre></div><p><em>칼럼 단위에도 권한을 부여할 수 있지만 칼럼 단위의 권한이 하나라도 설정되면 나머지 모든 테이블의 모든 칼럼에 대해서도 권한을 체크하기 때문에 전체적인 성능에 영향을 미칠수 있어 잘 사용하지 않는다.</em></p>
<h2 id=역할-role>역할 (Role)<a hidden class=anchor aria-hidden=true href=#역할-role>#</a></h2>
<h3 id=역할-생성>역할 생성<a hidden class=anchor aria-hidden=true href=#역할-생성>#</a></h3>
<p>MySQL 8.0 버전부터 권한을 묶어서 역할을 사용할 수 있게 됐다. 역할은 <code>CREATE ROLE</code> 명령을 이용해서 정의할 수 있다. 처음 역할을 생성하면 아무 권한이 존재하지 않지만 <code>GRANT</code> 명령으로 역할을 부여하면 된다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>USER</span> reader<span style=color:#f92672>@</span><span style=color:#e6db74>&#39;127.0.0.1&#39;</span> IDENTIFIED <span style=color:#66d9ef>BY</span> <span style=color:#e6db74>&#39;1234&#39;</span>;
Query OK, <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>rows</span> affected (<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>02</span> sec)

<span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>USER</span> <span style=color:#e6db74>&#39;writer&#39;</span><span style=color:#f92672>@</span><span style=color:#e6db74>&#39;127.0.0.1&#39;</span> IDENTIFIED <span style=color:#66d9ef>BY</span> <span style=color:#e6db74>&#39;1234&#39;</span>;
Query OK, <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>rows</span> affected (<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>01</span> sec)

<span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>ROLE</span> role_emp_read, role_emp_write;
Query OK, <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>rows</span> affected (<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>02</span> sec)

<span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>user</span>, <span style=color:#66d9ef>host</span>, account_locked <span style=color:#66d9ef>FROM</span> mysql.<span style=color:#66d9ef>user</span>;
<span style=color:#f92672>+</span><span style=color:#75715e>------------------+-----------+----------------+
</span><span style=color:#75715e></span><span style=color:#f92672>|</span> <span style=color:#66d9ef>user</span>             <span style=color:#f92672>|</span> <span style=color:#66d9ef>host</span>      <span style=color:#f92672>|</span> account_locked <span style=color:#f92672>|</span>
<span style=color:#f92672>+</span><span style=color:#75715e>------------------+-----------+----------------+
</span><span style=color:#75715e></span><span style=color:#f92672>|</span> role_emp_read    <span style=color:#f92672>|</span> <span style=color:#f92672>%</span>         <span style=color:#f92672>|</span> Y              <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span> role_emp_write   <span style=color:#f92672>|</span> <span style=color:#f92672>%</span>         <span style=color:#f92672>|</span> Y              <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span> role_read        <span style=color:#f92672>|</span> <span style=color:#f92672>%</span>         <span style=color:#f92672>|</span> Y              <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span> role_write       <span style=color:#f92672>|</span> <span style=color:#f92672>%</span>         <span style=color:#f92672>|</span> Y              <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span> root             <span style=color:#f92672>|</span> <span style=color:#f92672>%</span>         <span style=color:#f92672>|</span> N              <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span> mysql.infoschema <span style=color:#f92672>|</span> localhost <span style=color:#f92672>|</span> Y              <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span> mysql.<span style=color:#66d9ef>session</span>    <span style=color:#f92672>|</span> localhost <span style=color:#f92672>|</span> Y              <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span> mysql.sys        <span style=color:#f92672>|</span> localhost <span style=color:#f92672>|</span> Y              <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span> root             <span style=color:#f92672>|</span> localhost <span style=color:#f92672>|</span> N              <span style=color:#f92672>|</span>
<span style=color:#f92672>+</span><span style=color:#75715e>------------------+-----------+----------------+
</span><span style=color:#75715e></span><span style=color:#ae81ff>11</span> <span style=color:#66d9ef>rows</span> <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>set</span> (<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span> sec)

<span style=color:#66d9ef>GRANT</span> <span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>ON</span> employees.<span style=color:#f92672>*</span> <span style=color:#66d9ef>TO</span> role_emp_read;
Query OK, <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>rows</span> affected (<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>01</span> sec)

<span style=color:#66d9ef>GRANT</span> <span style=color:#66d9ef>INSERT</span>, <span style=color:#66d9ef>UPDATE</span>, <span style=color:#66d9ef>DELETE</span> <span style=color:#66d9ef>ON</span> employees.<span style=color:#f92672>*</span> <span style=color:#66d9ef>TO</span> role_emp_write;
Query OK, <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>rows</span> affected (<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>01</span> sec)

<span style=color:#66d9ef>GRANT</span> role_emp_read <span style=color:#66d9ef>TO</span> reader<span style=color:#f92672>@</span><span style=color:#ae81ff>127</span>.<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>1</span>;
Query OK, <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>rows</span> affected (<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>01</span> sec)

<span style=color:#66d9ef>GRANT</span> role_emp_write <span style=color:#66d9ef>TO</span> writer<span style=color:#f92672>@</span><span style=color:#ae81ff>127</span>.<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>1</span>;
Query OK, <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>rows</span> affected (<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>01</span> sec)
</code></pre></div><h3 id=계정에-역할-부여>계정에 역할 부여<a hidden class=anchor aria-hidden=true href=#계정에-역할-부여>#</a></h3>
<p>계정 로그인 후 <code>SET ROLE</code> 명령을 통해 역할을 활성화 해줘야 한다.</p>
<p>이 작업이 번거로우면 <code>activate_all_roles</code> 시스템 변수의 값을 <code>ON</code>으로 업데이트하면 로그인 시 역할이 자동으로 활성화 된다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>SHOW</span> GRANTS;
<span style=color:#f92672>+</span><span style=color:#75715e>---------------------------------------------------+
</span><span style=color:#75715e></span><span style=color:#f92672>|</span> Grants <span style=color:#66d9ef>for</span> reader<span style=color:#f92672>@</span><span style=color:#ae81ff>127</span>.<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>1</span>                       <span style=color:#f92672>|</span>
<span style=color:#f92672>+</span><span style=color:#75715e>---------------------------------------------------+
</span><span style=color:#75715e></span><span style=color:#f92672>|</span> <span style=color:#66d9ef>GRANT</span> <span style=color:#66d9ef>USAGE</span> <span style=color:#66d9ef>ON</span> <span style=color:#f92672>*</span>.<span style=color:#f92672>*</span> <span style=color:#66d9ef>TO</span> <span style=color:#f92672>`</span>reader<span style=color:#f92672>`@`</span><span style=color:#ae81ff>127</span>.<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>1</span><span style=color:#f92672>`</span>        <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span> <span style=color:#66d9ef>GRANT</span> <span style=color:#f92672>`</span>role_emp_read<span style=color:#f92672>`@`%`</span> <span style=color:#66d9ef>TO</span> <span style=color:#f92672>`</span>reader<span style=color:#f92672>`@`</span><span style=color:#ae81ff>127</span>.<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>1</span><span style=color:#f92672>`</span> <span style=color:#f92672>|</span>
<span style=color:#f92672>+</span><span style=color:#75715e>---------------------------------------------------+
</span><span style=color:#75715e></span><span style=color:#ae81ff>2</span> <span style=color:#66d9ef>rows</span> <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>set</span> (<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span> sec)

<span style=color:#66d9ef>SHOW</span> GRANTS;
<span style=color:#f92672>+</span><span style=color:#75715e>----------------------------------------------------+
</span><span style=color:#75715e></span><span style=color:#f92672>|</span> Grants <span style=color:#66d9ef>for</span> writer<span style=color:#f92672>@</span><span style=color:#ae81ff>127</span>.<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>1</span>                        <span style=color:#f92672>|</span>
<span style=color:#f92672>+</span><span style=color:#75715e>----------------------------------------------------+
</span><span style=color:#75715e></span><span style=color:#f92672>|</span> <span style=color:#66d9ef>GRANT</span> <span style=color:#66d9ef>USAGE</span> <span style=color:#66d9ef>ON</span> <span style=color:#f92672>*</span>.<span style=color:#f92672>*</span> <span style=color:#66d9ef>TO</span> <span style=color:#f92672>`</span>writer<span style=color:#f92672>`@`</span><span style=color:#ae81ff>127</span>.<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>1</span><span style=color:#f92672>`</span>         <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span> <span style=color:#66d9ef>GRANT</span> <span style=color:#f92672>`</span>role_emp_write<span style=color:#f92672>`@`%`</span> <span style=color:#66d9ef>TO</span> <span style=color:#f92672>`</span>writer<span style=color:#f92672>`@`</span><span style=color:#ae81ff>127</span>.<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>1</span><span style=color:#f92672>`</span> <span style=color:#f92672>|</span>
<span style=color:#f92672>+</span><span style=color:#75715e>----------------------------------------------------+
</span><span style=color:#75715e></span><span style=color:#ae81ff>2</span> <span style=color:#66d9ef>rows</span> <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>set</span> (<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span> sec)

<span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>current_role</span>();
<span style=color:#f92672>+</span><span style=color:#75715e>----------------+
</span><span style=color:#75715e></span><span style=color:#f92672>|</span> <span style=color:#66d9ef>current_role</span>() <span style=color:#f92672>|</span>
<span style=color:#f92672>+</span><span style=color:#75715e>----------------+
</span><span style=color:#75715e></span><span style=color:#f92672>|</span> <span style=color:#66d9ef>NONE</span>           <span style=color:#f92672>|</span>
<span style=color:#f92672>+</span><span style=color:#75715e>----------------+
</span><span style=color:#75715e></span><span style=color:#ae81ff>1</span> <span style=color:#66d9ef>row</span> <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>set</span> (<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span> sec)

<span style=color:#66d9ef>SET</span> <span style=color:#66d9ef>ROLE</span> role_emp_write;
Query OK, <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>rows</span> affected (<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span> sec)

<span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>current_role</span>();
<span style=color:#f92672>+</span><span style=color:#75715e>----------------------+
</span><span style=color:#75715e></span><span style=color:#f92672>|</span> <span style=color:#66d9ef>current_role</span>()       <span style=color:#f92672>|</span>
<span style=color:#f92672>+</span><span style=color:#75715e>----------------------+
</span><span style=color:#75715e></span><span style=color:#f92672>|</span> <span style=color:#f92672>`</span>role_emp_write<span style=color:#f92672>`@`%`</span> <span style=color:#f92672>|</span>
<span style=color:#f92672>+</span><span style=color:#75715e>----------------------+
</span><span style=color:#75715e></span><span style=color:#ae81ff>1</span> <span style=color:#66d9ef>row</span> <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>set</span> (<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span> sec)

<span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>user</span>, <span style=color:#66d9ef>host</span>, account_locked <span style=color:#66d9ef>FROM</span> mysql.<span style=color:#66d9ef>user</span>;
<span style=color:#f92672>+</span><span style=color:#75715e>------------------+-----------+----------------+
</span><span style=color:#75715e></span><span style=color:#f92672>|</span> <span style=color:#66d9ef>user</span>             <span style=color:#f92672>|</span> <span style=color:#66d9ef>host</span>      <span style=color:#f92672>|</span> account_locked <span style=color:#f92672>|</span>
<span style=color:#f92672>+</span><span style=color:#75715e>------------------+-----------+----------------+
</span><span style=color:#75715e></span><span style=color:#f92672>|</span> role_emp_read    <span style=color:#f92672>|</span> <span style=color:#f92672>%</span>         <span style=color:#f92672>|</span> Y              <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span> role_emp_write   <span style=color:#f92672>|</span> <span style=color:#f92672>%</span>         <span style=color:#f92672>|</span> Y              <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span> role_read        <span style=color:#f92672>|</span> <span style=color:#f92672>%</span>         <span style=color:#f92672>|</span> Y              <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span> role_write       <span style=color:#f92672>|</span> <span style=color:#f92672>%</span>         <span style=color:#f92672>|</span> Y              <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span> root             <span style=color:#f92672>|</span> <span style=color:#f92672>%</span>         <span style=color:#f92672>|</span> N              <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span> reader           <span style=color:#f92672>|</span> <span style=color:#ae81ff>127</span>.<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span> N              <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span> writer           <span style=color:#f92672>|</span> <span style=color:#ae81ff>127</span>.<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span> N              <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span> mysql.infoschema <span style=color:#f92672>|</span> localhost <span style=color:#f92672>|</span> Y              <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span> mysql.<span style=color:#66d9ef>session</span>    <span style=color:#f92672>|</span> localhost <span style=color:#f92672>|</span> Y              <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span> mysql.sys        <span style=color:#f92672>|</span> localhost <span style=color:#f92672>|</span> Y              <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span> root             <span style=color:#f92672>|</span> localhost <span style=color:#f92672>|</span> N              <span style=color:#f92672>|</span>
<span style=color:#f92672>+</span><span style=color:#75715e>------------------+-----------+----------------+
</span><span style=color:#75715e></span><span style=color:#ae81ff>11</span> <span style=color:#66d9ef>rows</span> <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>set</span> (<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span> sec)
</code></pre></div><h3 id=역할과-계정의-차이>역할과 계정의 차이<a hidden class=anchor aria-hidden=true href=#역할과-계정의-차이>#</a></h3>
<ol>
<li>서버 내부적으로 역할과 계정은 아무런 차이가 없다.</li>
<li><code>CREATE ROLE</code> 명령으로 생성된 역할은 <code>account_locked</code> 컬럼이 <code>Y</code>로 설정되어 로그인할 수 없도록 생성된다.</li>
<li>역할의 호스트 부분은 역할을 다른 계정에 부여하지 않고 직접 로그인할 때에만 의미가 있고 역할 상태에서는 아무런 영향이 없다.</li>
<li>역할과 계정은 실제로 DB에서도 구분하기 힘들기 때문에 <code>role_</code>과 같은 prefix를 붙여 구분할 수 있도록 하는 것이 좋다.</li>
</ol>
<p>구매 링크: <a href=http://www.yes24.com/Product/Goods/103415627>http://www.yes24.com/Product/Goods/103415627</a></p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://blog.realsangil.net/tags/mysql/>mysql</a></li>
<li><a href=https://blog.realsangil.net/tags/real-mysql/>real-mysql</a></li>
</ul>
<nav class=paginav>
<a class=prev href=https://blog.realsangil.net/posts/2021-12-29-golang-test/>
<span class=title>« Prev Page</span>
<br>
<span>Golang TestMain이란?</span>
</a>
<a class=next href=https://blog.realsangil.net/posts/2021-11-29-real-mysql-2/>
<span class=title>Next Page »</span>
<br>
<span>[Real MySQL 8.0] #2 설치와 설정</span>
</a>
</nav>
</footer><script src=https://utteranc.es/client.js repo=realsangil/realsangil.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script>
</article>
</main>
<footer class=footer>
<span>&copy; 2021 <a href=https://blog.realsangil.net>Realsangil</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>