<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Golang TestMain이란? | Realsangil</title>
<meta name=keywords content="golang,testing">
<meta name=description content="이 포스트는 TestMain가 무엇이며, 어떤 식으로 사용할 수 있는지에 대해서 정리한 내용입니다.">
<meta name=author content="박상일">
<link rel=canonical href=https://blog.realsangil.net/posts/2021-12-29-golang-test/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.realsangil.net/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://blog.realsangil.net/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://blog.realsangil.net/favicon-32x32.png>
<link rel=apple-touch-icon href=https://blog.realsangil.net/apple-touch-icon.png>
<link rel=mask-icon href=https://blog.realsangil.net/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.91.2">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
</noscript>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MMTYEB98J6"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-MMTYEB98J6',{anonymize_ip:!1})}</script>
<meta property="og:title" content="Golang TestMain이란?">
<meta property="og:description" content="이 포스트는 TestMain가 무엇이며, 어떤 식으로 사용할 수 있는지에 대해서 정리한 내용입니다.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://blog.realsangil.net/posts/2021-12-29-golang-test/">
<meta property="og:image" content="https://blog.realsangil.net/images/covers/golang.png"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-12-29T20:34:00+09:00">
<meta property="article:modified_time" content="2021-12-29T20:34:00+09:00">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://blog.realsangil.net/images/covers/golang.png">
<meta name=twitter:title content="Golang TestMain이란?">
<meta name=twitter:description content="이 포스트는 TestMain가 무엇이며, 어떤 식으로 사용할 수 있는지에 대해서 정리한 내용입니다.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://blog.realsangil.net/posts/"},{"@type":"ListItem","position":3,"name":"Golang TestMain이란?","item":"https://blog.realsangil.net/posts/2021-12-29-golang-test/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Golang TestMain이란?","name":"Golang TestMain이란?","description":"이 포스트는 TestMain가 무엇이며, 어떤 식으로 사용할 수 있는지에 대해서 정리한 내용입니다.\n","keywords":["golang","testing"],"articleBody":"이 포스트는 TestMain가 무엇이며, 어떤 식으로 사용할 수 있는지에 대해서 정리한 내용입니다.\nTestMain  이번 포스트에서 말하는 TestMain은 main 함수의 테스트가 아닙니다.\n 가끔 테스트를 작성하다보면 테스트에 필요한 setup이나 teardown이 필요할 때가 있습니다.\nGo에서는 테스트 패키지에 따로 setup이나 teardown을 제공하고 있지 않기 때문에 TestMain(m *testing.M)을 통해서 해당 작업을 해야 합니다.\n예를 들어, 테스트 전에 임시 DB를 생성하고 테스트가 완료되면 임시 DB를 지워야 하는 경우가 있는데 Go 언어에서는 을 통해서 테스트 전후로 필요한 작업들을 할 수 있습니다.\n테스트 코드 코드는 매우 간단합니다.\nfunc TestMain(m *testing.M) { // 테스트 전처리 작업  exitCode := m.Run() // 테스트 후 처리 작업  os.Exit(exitCode) } 아래에 테스트를 위해 작성한 간단한 코드를 통해서 TestMain이 어떻게 동작하는지 확인해보겠습니다.\npackage main import ( \"fmt\" \"os\" \"testing\" ) func init() { fmt.Println(\"init 함수 실행\") } func TestMain(m *testing.M) { setup() code := m.Run() teardown() os.Exit(code) } func Test_execute1(t *testing.T) { execute1() } func Test_execute2(t *testing.T) { execute2() } func execute1() { fmt.Println(\"TEST-1 테스트 중입니다.\") } func execute2() { fmt.Println(\"TEST-2 테스트 중입니다.\") } func setup() { fmt.Println(\"setup...\") } func teardown() {` fmt.Println(\"teardown...\") } go test init 함수 실행 setup... TEST-1 테스트 중입니다. TEST-2 테스트 중입니다. PASS teardown... 테스트 코드를 실행해보면 Test_execute1과 Test_execute2를 실행 전후로 setup, teardown가 함수가 실행되는걸 확인할 수 있습니다.\n실제로 Go언어로 작성된 mattermost의 서버는 db 테스트 시 TestMain을 이용하여 테스트 전후로 테스트 DB를 만들고 삭제하고 있습니다.\n가끔 패키지에서 테스트에 자원할당이나 해제와 같은 작업들이 공통적으로 필요할 때 사용하면 매우 유용할 거 같습니다.\nReferences  https://pkg.go.dev/testing#hdr-Main http://cs-guy.com/blog/2015/01/test-main/ ","wordCount":"233","inLanguage":"en","image":"https://blog.realsangil.net/images/covers/golang.png","datePublished":"2021-12-29T20:34:00+09:00","dateModified":"2021-12-29T20:34:00+09:00","author":{"@type":"Person","name":"박상일"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.realsangil.net/posts/2021-12-29-golang-test/"},"publisher":{"@type":"Organization","name":"Realsangil","logo":{"@type":"ImageObject","url":"https://blog.realsangil.net/favicon.ico"}}}</script>
</head>
<body id=top>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://blog.realsangil.net accesskey=h title="Realsangil (Alt + H)">Realsangil</a>
<span class=logo-switches>
</span>
</div>
<ul id=menu>
<li>
<a href=https://blog.realsangil.net/posts/ title=posts>
<span>posts</span>
</a>
</li>
<li>
<a href=https://blog.realsangil.net/tags/ title=tags>
<span>tags</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://blog.realsangil.net>Home</a>&nbsp;»&nbsp;<a href=https://blog.realsangil.net/posts/>Posts</a></div>
<h1 class=post-title>
Golang TestMain이란?
</h1>
<div class=post-meta><span title="2021-12-29 20:34:00 +0900 +0900">December 29, 2021</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;박상일
</div>
</header>
<figure class=entry-cover><img loading=lazy src=https://blog.realsangil.net/images/covers/golang.png alt>
</figure><div class=toc>
<details open>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><ul>
<li>
<a href=#testmain aria-label=TestMain>TestMain</a></li>
<li>
<a href=#%ed%85%8c%ec%8a%a4%ed%8a%b8-%ec%bd%94%eb%93%9c aria-label="테스트 코드">테스트 코드</a></li>
<li>
<a href=#references aria-label=References>References</a>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><p>이 포스트는 <code>TestMain</code>가 무엇이며, 어떤 식으로 사용할 수 있는지에 대해서 정리한 내용입니다.</p>
<h2 id=testmain>TestMain<a hidden class=anchor aria-hidden=true href=#testmain>#</a></h2>
<blockquote>
<p>이번 포스트에서 말하는 TestMain은 main 함수의 테스트가 아닙니다.</p>
</blockquote>
<p>가끔 테스트를 작성하다보면 테스트에 필요한 setup이나 teardown이 필요할 때가 있습니다.</p>
<p>Go에서는 테스트 패키지에 따로 setup이나 teardown을 제공하고 있지 않기 때문에 <code>TestMain(m *testing.M)</code>을 통해서 해당 작업을 해야 합니다.</p>
<p>예를 들어, 테스트 전에 임시 DB를 생성하고 테스트가 완료되면 임시 DB를 지워야 하는 경우가 있는데 Go 언어에서는 을 통해서 테스트 전후로 필요한 작업들을 할 수 있습니다.</p>
<h2 id=테스트-코드>테스트 코드<a hidden class=anchor aria-hidden=true href=#테스트-코드>#</a></h2>
<p>코드는 매우 간단합니다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestMain</span>(<span style=color:#a6e22e>m</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>M</span>) {
    <span style=color:#75715e>// 테스트 전처리 작업
</span><span style=color:#75715e></span>    
    <span style=color:#a6e22e>exitCode</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>Run</span>()

    <span style=color:#75715e>// 테스트 후 처리 작업
</span><span style=color:#75715e></span>
    <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Exit</span>(<span style=color:#a6e22e>exitCode</span>)
}
</code></pre></div><p>아래에 테스트를 위해 작성한 간단한 코드를 통해서 <code>TestMain</code>이 어떻게 동작하는지 확인해보겠습니다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>

<span style=color:#f92672>import</span> (
    <span style=color:#e6db74>&#34;fmt&#34;</span>
    <span style=color:#e6db74>&#34;os&#34;</span>
    <span style=color:#e6db74>&#34;testing&#34;</span>
)

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>init</span>() {
    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;init 함수 실행&#34;</span>)
}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestMain</span>(<span style=color:#a6e22e>m</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>M</span>) {
    <span style=color:#a6e22e>setup</span>()
    <span style=color:#a6e22e>code</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>Run</span>()
    <span style=color:#a6e22e>teardown</span>()
    <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Exit</span>(<span style=color:#a6e22e>code</span>)
}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Test_execute1</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
    <span style=color:#a6e22e>execute1</span>()
}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Test_execute2</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
    <span style=color:#a6e22e>execute2</span>()
}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>execute1</span>() {
    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;TEST-1 테스트 중입니다.&#34;</span>)
}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>execute2</span>() {
    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;TEST-2 테스트 중입니다.&#34;</span>)
}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>setup</span>() {
    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;setup...&#34;</span>)
}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>teardown</span>() {<span style=color:#960050;background-color:#1e0010>`</span>
    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;teardown...&#34;</span>)
}
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>go test  

init 함수 실행
setup...
TEST-1 테스트 중입니다.
TEST-2 테스트 중입니다.
PASS
teardown...
</code></pre></div><p>테스트 코드를 실행해보면 <code>Test_execute1</code>과 <code>Test_execute2</code>를 실행 전후로 <code>setup</code>, <code>teardown</code>가 함수가 실행되는걸 확인할 수 있습니다.</p>
<p>실제로 Go언어로 작성된 <a href=https://github.com/mattermost/mattermost-server>mattermost의 서버</a>는 db 테스트 시 <code>TestMain</code>을 이용하여 테스트 전후로 테스트 DB를 만들고 삭제하고 있습니다.</p>
<p>가끔 패키지에서 테스트에 자원할당이나 해제와 같은 작업들이 공통적으로 필요할 때 사용하면 매우 유용할 거 같습니다.</p>
<h2 id=references>References<a hidden class=anchor aria-hidden=true href=#references>#</a></h2>
<ul>
<li><a href=https://pkg.go.dev/testing#hdr-Main>https://pkg.go.dev/testing#hdr-Main</a></li>
<li><a href=http://cs-guy.com/blog/2015/01/test-main/>http://cs-guy.com/blog/2015/01/test-main/</a></li>
</ul>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://blog.realsangil.net/tags/golang/>golang</a></li>
<li><a href=https://blog.realsangil.net/tags/testing/>testing</a></li>
</ul>
<nav class=paginav>
<a class=next href=https://blog.realsangil.net/posts/2021-12-03-real-mysql-3/>
<span class=title>Next Page »</span>
<br>
<span>[Real MySQL 8.0] #3 사용자 및 권한</span>
</a>
</nav>
</footer><script src=https://utteranc.es/client.js repo=realsangil/realsangil.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script>
</article>
</main>
<footer class=footer>
<span>&copy; 2021 <a href=https://blog.realsangil.net>Realsangil</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>