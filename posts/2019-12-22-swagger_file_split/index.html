<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Swagger 파일 분리하여 관리하기 | Realsangil</title>
<meta name=keywords content="openapi,documentation">
<meta name=description content="Swagger로 API 문서를 작성하다 보면 스팩 파일(swagger.yaml)이 너무 길어져서 관리가 어려울 때가 있습니다. 그래서 swagger에서는 $ref를 제공해 parameter와 ruqestbody, response 등을 모듈처럼 사용할 수 있도록 제공하지만 이것 또한 API가 많아지면 스펙파일이 길어지기 마련이죠. 그래서 parameter와 ruqestbody, response은 물론 엔드포인트들을 파일로 분리해서 모듈처럼 관리하여 쉽게 유지보수 하는 걸 이번 포스트에서 해보려고 합니다. 모든 개발에는 유지보수가 가장 중요한 법이니까요.">
<meta name=author content="박상일">
<link rel=canonical href=https://blog.realsangil.net/posts/2019-12-22-swagger_file_split/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.realsangil.net/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://blog.realsangil.net/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://blog.realsangil.net/favicon-32x32.png>
<link rel=apple-touch-icon href=https://blog.realsangil.net/apple-touch-icon.png>
<link rel=mask-icon href=https://blog.realsangil.net/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.91.2">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
</noscript>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MMTYEB98J6"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-MMTYEB98J6',{anonymize_ip:!1})}</script>
<meta property="og:title" content="Swagger 파일 분리하여 관리하기">
<meta property="og:description" content="Swagger로 API 문서를 작성하다 보면 스팩 파일(swagger.yaml)이 너무 길어져서 관리가 어려울 때가 있습니다. 그래서 swagger에서는 $ref를 제공해 parameter와 ruqestbody, response 등을 모듈처럼 사용할 수 있도록 제공하지만 이것 또한 API가 많아지면 스펙파일이 길어지기 마련이죠. 그래서 parameter와 ruqestbody, response은 물론 엔드포인트들을 파일로 분리해서 모듈처럼 관리하여 쉽게 유지보수 하는 걸 이번 포스트에서 해보려고 합니다. 모든 개발에는 유지보수가 가장 중요한 법이니까요.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://blog.realsangil.net/posts/2019-12-22-swagger_file_split/">
<meta property="og:image" content="https://raw.githubusercontent.com/swagger-api/swagger.io/wordpress/images/assets/SWU-logo-clr.png"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2019-12-22T16:36:37+09:00">
<meta property="article:modified_time" content="2019-12-22T16:36:37+09:00">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://raw.githubusercontent.com/swagger-api/swagger.io/wordpress/images/assets/SWU-logo-clr.png">
<meta name=twitter:title content="Swagger 파일 분리하여 관리하기">
<meta name=twitter:description content="Swagger로 API 문서를 작성하다 보면 스팩 파일(swagger.yaml)이 너무 길어져서 관리가 어려울 때가 있습니다. 그래서 swagger에서는 $ref를 제공해 parameter와 ruqestbody, response 등을 모듈처럼 사용할 수 있도록 제공하지만 이것 또한 API가 많아지면 스펙파일이 길어지기 마련이죠. 그래서 parameter와 ruqestbody, response은 물론 엔드포인트들을 파일로 분리해서 모듈처럼 관리하여 쉽게 유지보수 하는 걸 이번 포스트에서 해보려고 합니다. 모든 개발에는 유지보수가 가장 중요한 법이니까요.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://blog.realsangil.net/posts/"},{"@type":"ListItem","position":3,"name":"Swagger 파일 분리하여 관리하기","item":"https://blog.realsangil.net/posts/2019-12-22-swagger_file_split/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Swagger 파일 분리하여 관리하기","name":"Swagger 파일 분리하여 관리하기","description":"Swagger로 API 문서를 작성하다 보면 스팩 파일(swagger.yaml)이 너무 길어져서 관리가 어려울 때가 있습니다. 그래서 swagger에서는 $ref를 제공해 parameter와 ruqestbody, response 등을 모듈처럼 사용할 수 있도록 제공하지만 이것 또한 API가 많아지면 스펙파일이 길어지기 마련이죠. 그래서 parameter와 ruqestbody, response은 물론 엔드포인트들을 파일로 분리해서 모듈처럼 관리하여 쉽게 유지보수 하는 걸 이번 포스트에서 해보려고 합니다. 모든 개발에는 유지보수가 가장 중요한 법이니까요.\n","keywords":["openapi","documentation"],"articleBody":"Swagger로 API 문서를 작성하다 보면 스팩 파일(swagger.yaml)이 너무 길어져서 관리가 어려울 때가 있습니다. 그래서 swagger에서는 $ref를 제공해 parameter와 ruqestbody, response 등을 모듈처럼 사용할 수 있도록 제공하지만 이것 또한 API가 많아지면 스펙파일이 길어지기 마련이죠. 그래서 parameter와 ruqestbody, response은 물론 엔드포인트들을 파일로 분리해서 모듈처럼 관리하여 쉽게 유지보수 하는 걸 이번 포스트에서 해보려고 합니다. 모든 개발에는 유지보수가 가장 중요한 법이니까요.\n준비하기 우선, 우리는 스펙파일을 준비해야 합니다. 이번 포스트는 openapi v3를 기준으로 작성할것이며 v2도 전체적인 흐름은 같으니 따라해보셔도 문제가 없습니다. 먼저, 이미 스펙파일을 가지고 계신 분은 가지고 계신 스펙파일을 이용하시면되지만 저는 petstore.yaml을 조금 수정한 파일을 사용해 나눠보려 합니다.\nopenapi: \"3.0.0\" info: version: 1.0.0 title: Swagger Petstore license: name: MIT servers: - url: http://petstore.swagger.io/v1 paths: /pets: get: summary: List all pets operationId: listPets tags: - pets parameters: - name: limit in: query description: How many items to return at one time (max 100) required: false schema: type: integer format: int32 responses: '200': description: A paged array of pets headers: x-next: description: A link to the next page of responses schema: type: string content: application/json: schema: $ref: \"#/components/schemas/Pets\" default: description: unexpected error content: application/json: schema: $ref: \"#/components/schemas/Error\" post: summary: Create a pet operationId: createPets tags: - pets requestBody: description: unexpected error content: application/json: schema: type: object properties: name: type: string tags: type: string responses: '201': description: Null response default: description: unexpected error content: application/json: schema: $ref: \"#/components/schemas/Error\" /pets/{petId}: get: summary: Info for a specific pet operationId: showPetById tags: - pets parameters: - name: petId in: path required: true description: The id of the pet to retrieve schema: type: string responses: '200': description: Expected response to a valid request content: application/json: schema: $ref: \"#/components/schemas/Pet\" default: description: unexpected error content: application/json: schema: $ref: \"#/components/schemas/Error\" put: summary: Edit a pet tags: - pets parameters: - name: petId in: path required: true description: The id of the pet to retrieve schema: type: string requestBody: description: unexpected error content: application/json: schema: type: object properties: name: type: string tags: type: string responses: '201': description: Null response default: description: unexpected error content: application/json: schema: $ref: \"#/components/schemas/Error\" components: schemas: Pet: required: - id - name properties: id: type: integer format: int64 name: type: string tags: type: string Pets: type: array items: $ref: \"#/components/schemas/Pet\" Error: required: - code - message properties: code: type: integer format: int32 message: type: string 우선 edited_petstore.yaml파일을 보시면 한번이라도 swagger를 사용해보신 분이라면 이정도 스펙파일은 길지 않다는 걸 잘 알고 계실 겁니다.\n이미 $ref를 사용해 schema들을 모듈화해서 중복을 최대한 줄이려고 했습니다만. 중복되는 부분이 세개가 보이네요.\n POST /pets와 PUT /pets/{pet_id}의 requestBody GET /pets/{pet_id}와 PUT /pets/{pet_id}의 pet_id 파라메터 반복되는 response의 unexpected error  저는 이 두개의 중복과 스키마, 그리고 엔드포인트들을 파일로 나눠보려 합니다.\n1. requestBody 분리하기 중복되는 requestBody를 requestBodies/pet.yaml 파일로 옮겨보겠습니다.\n# requestBodies/pet.yaml description: 'pet create/edit request' content: application/json: schema: type: object properties: name: type: string tags: type: string # swagger.yaml /pets: post: summary: Create a pet operationId: createPets tags: - pets requestBody: $ref: 'requestBodies/pet.yaml' responses: '201': description: Null response default: description: unexpected error content: application/json: schema: $ref: \"#/components/schemas/Error\" /pets/{petId}: put: summary: Edit a pet tags: - pets parameters: - name: petId in: path required: true description: The id of the pet to retrieve schema: type: string requestBody: $ref: 'requestBodies/pet.yaml' responses: '201': description: Null response default: description: unexpected error content: application/json: schema: $ref: \"#/components/schemas/Error\" 위 처럼 나눈 파일을 봤을때 주의해야할 것이 requestBody에 있는 $ref입니다. $ref는 swagger.yaml의 위치를 기준으로 relative path로 pet.yaml 파일을 찾습니다.\n. ├── requestBodies │ └── pet.yaml └── swagger.yaml 파일을 나눈 후 위와같은 폴더 구조를 갖습니다.\n2. parameter 분리하기 이번에는 중복되는 parameter인 petId를 분리 해보겠습니다.\n# parameter.yaml queryPetId: name: petId in: path required: true description: The id of the pet to retrieve schema: type: string # swagger.yaml /pets/{petId}: get: summary: Info for a specific pet operationId: showPetById tags: - pets parameters: - $ref: 'parameters.yaml#/queryPetId' responses: '200': description: Expected response to a valid request content: application/json: schema: $ref: \"#/components/schemas/Pet\" default: description: unexpected error content: application/json: schema: $ref: \"#/components/schemas/Error\" put: summary: Edit a pet tags: - pets parameters: - $ref: 'parameters.yaml#/queryPetId' requestBody: $ref: 'requestBodies/pet.yaml' responses: '201': description: Null response default: description: unexpected error content: application/json: schema: $ref: \"#/components/schemas/Error\" 위와 같이 파일을 분리하였고 아래와 같은 폴더 구조가 되었습니다.\n. ├── parameters.yaml ├── requestBodies │ └── pet.yaml └── swagger.yaml parameters: - $ref: 'parameters.yaml#/queryPetId' 이번 $ref는 좀 다르게 생겼습니다. 파일을 링크하긴 하지만 뒤에 #/queryPetId가 붙었습니다. 이 표현은 한 파일 안에 다수의 파라메터들이 적용되었을 때 특정 파라메터를 참조하고 싶을 때 사용할 수 있는 표현입니다. 이 표현은 parameter에만 한정된 것이 아니고 requestBody, response, schema에도 사용할 수 있습니다.\n3. 중복된 response 분리하기 이번에는 response에서 계속 반복되던 unexpect error 부분을 수정해보겠습니다. 이 때 components/schemas에 있는 schema들도 함께 파일로 분리해보겠습니다.\n# responses/unexpected_error.yaml description: unexpected error content: application/json: schema: $ref: \"#/components/schemas/Error\" 먼저 손쉽게 error를 분리했습니다.\n# schemas.yaml Pet: required: - id - name properties: id: type: integer format: int64 name: type: string tags: type: string Pets: type: array items: $ref: \"schemas.yaml#/Pet\" Error: required: - code - message properties: code: type: integer format: int32 message: type: string 그다음 위와 같이 schemas.yaml을 분리하고 components를 삭제했습니다. 이때 Error를 찾지 못해서 에러가 발생합니다. 이유는 components/schemas들을 모두 삭제해서 찾을 수 없기 때문이죠. 이때 파일간의 참조는 어떻게 하는지 배울 수 있습니다.\n분리한 # responses/unexpected_error.yaml 아래와 같이 수정하겠습니다.\n# responses/unexpected_error.yaml description: unexpected error content: application/json: schema: $ref: \"../schemas.yaml#/Error\" 수정한 파일 내용을 보면 swagger.yaml가 다른 파일을 참조할 때처럼 responses/unexpected_error.yaml을 기준으로 schemas.yaml을 참조하시면 됩니다.\n위와 같이 수정하고 나면 최종적으로 swagger.yaml는 아래와 같은 형태를 띄게 됩니다.\n# swagger.yaml openapi: \"3.0.0\" info: version: 1.0.0 title: Swagger Petstore license: name: MIT servers: - url: http://petstore.swagger.io/v1 paths: /pets: get: summary: List all pets operationId: listPets tags: - pets parameters: - name: limit in: query description: How many items to return at one time (max 100) required: false schema: type: integer format: int32 responses: '200': description: A paged array of pets content: application/json: schema: $ref: \"schemas.yaml#/Pets\" default: $ref: 'responses/unexpected_error.yaml' post: summary: Create a pet operationId: createPets tags: - pets requestBody: $ref: 'requestBodies/pet.yaml' responses: '201': description: Null response default: $ref: 'responses/unexpected_error.yaml' /pets/{petId}: get: summary: Info for a specific pet operationId: showPetById tags: - pets parameters: - $ref: 'parameters.yaml#/queryPetId' responses: '200': description: Expected response to a valid request content: application/json: schema: $ref: \"schemas.yaml#/Pet\" default: $ref: 'responses/unexpected_error.yaml' put: summary: Edit a pet tags: - pets parameters: - $ref: 'parameters.yaml#/queryPetId' requestBody: $ref: 'requestBodies/pet.yaml' responses: '201': description: Null response default: $ref: 'responses/unexpected_error.yaml' 그리고 아래와 같은 형태의 디렉토리 구조가 됩니다.\n. ├── parameters.yaml ├── requestBodies │ └── pet.yaml ├── responses │ └── unexpected_error.yaml ├── schemas.yaml └── swagger.yaml 요약  $ref를 이용하여 스펙파일을 모듈화하면 유지보수가 용이해진다. 참조  파일 참조는 $ref를 사용한다. 파일간의 참조는 현재 파일 위치를 기준으로 참조할 파일의 relative path를 사용하면 된다.    마치며… 위의 예제들을 보면 두서없이 파일을 나눈것 처럼 보입니다. 이것은 단지 독자들에게 다양한 형태의 참조를 보여드리기 위해서 이런 형태를 만들어 보았습니다. 물론 실제로 사용할 때는 좀 더 일관성 있는 형태의 구조로 사용하는 것이 좋습니다.\n위의 예제들은 이곳에 업로드 했으니 참조하시면 될 것 같습니다.\n추가적인 팁 저는 이렇게 만든 파일들을 배포할 때는 전체 파일을 배포하기보다는 하나의 파일로 묶어서 배포합니다. 이때 사용할 수 있는게 openapi-generator입니다.\nopenapi-generator generate -i ./swagger.yaml -g openapi-yaml -o compiled 위의 커맨드를 사용하게 되면 나눠져 있던 파일들을 모아서 우리가 처음에 나누지 않았던 형태의 파일처럼 하나로 합쳐주게 됩니다.\n자세한 설치방법과 사용법은 (openapi-generator)[https://github.com/OpenAPITools/openapi-generator] 를 참조하시면 될 것 같습니다.\nReference  https://swagger.io/docs/specification/using-ref ","wordCount":"1166","inLanguage":"en","image":"https://raw.githubusercontent.com/swagger-api/swagger.io/wordpress/images/assets/SWU-logo-clr.png","datePublished":"2019-12-22T16:36:37+09:00","dateModified":"2019-12-22T16:36:37+09:00","author":{"@type":"Person","name":"박상일"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.realsangil.net/posts/2019-12-22-swagger_file_split/"},"publisher":{"@type":"Organization","name":"Realsangil","logo":{"@type":"ImageObject","url":"https://blog.realsangil.net/favicon.ico"}}}</script>
</head>
<body id=top>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://blog.realsangil.net accesskey=h title="Realsangil (Alt + H)">Realsangil</a>
<span class=logo-switches>
</span>
</div>
<ul id=menu>
<li>
<a href=https://blog.realsangil.net/posts/ title=posts>
<span>posts</span>
</a>
</li>
<li>
<a href=https://blog.realsangil.net/tags/ title=tags>
<span>tags</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://blog.realsangil.net>Home</a>&nbsp;»&nbsp;<a href=https://blog.realsangil.net/posts/>Posts</a></div>
<h1 class=post-title>
Swagger 파일 분리하여 관리하기
</h1>
<div class=post-meta><span title="2019-12-22 16:36:37 +0900 +0900">December 22, 2019</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;박상일
</div>
</header>
<figure class=entry-cover><img loading=lazy src=https://raw.githubusercontent.com/swagger-api/swagger.io/wordpress/images/assets/SWU-logo-clr.png alt>
</figure><div class=toc>
<details open>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><ul>
<li>
<a href=#%ec%a4%80%eb%b9%84%ed%95%98%ea%b8%b0 aria-label=준비하기>준비하기</a><ul>
<li>
<a href=#1-requestbody-%eb%b6%84%eb%a6%ac%ed%95%98%ea%b8%b0 aria-label="1. requestBody 분리하기">1. requestBody 분리하기</a></li>
<li>
<a href=#2-parameter-%eb%b6%84%eb%a6%ac%ed%95%98%ea%b8%b0 aria-label="2. parameter 분리하기">2. parameter 분리하기</a></li>
<li>
<a href=#3-%ec%a4%91%eb%b3%b5%eb%90%9c-response-%eb%b6%84%eb%a6%ac%ed%95%98%ea%b8%b0 aria-label="3. 중복된 response 분리하기">3. 중복된 response 분리하기</a></li></ul>
</li>
<li>
<a href=#%ec%9a%94%ec%95%bd aria-label=요약>요약</a></li>
<li>
<a href=#%eb%a7%88%ec%b9%98%eb%a9%b0 aria-label=마치며&amp;hellip;>마치며&mldr;</a><ul>
<li>
<a href=#%ec%b6%94%ea%b0%80%ec%a0%81%ec%9d%b8-%ed%8c%81 aria-label="추가적인 팁">추가적인 팁</a></li></ul>
</li>
<li>
<a href=#reference aria-label=Reference>Reference</a>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><p>Swagger로 API 문서를 작성하다 보면 스팩 파일(swagger.yaml)이 너무 길어져서 관리가 어려울 때가 있습니다. 그래서 swagger에서는 <code>$ref</code>를 제공해 parameter와 ruqestbody, response 등을 모듈처럼 사용할 수 있도록 제공하지만 이것 또한 API가 많아지면 스펙파일이 길어지기 마련이죠. 그래서 parameter와 ruqestbody, response은 물론 엔드포인트들을 파일로 분리해서 모듈처럼 관리하여 쉽게 유지보수 하는 걸 이번 포스트에서 해보려고 합니다. 모든 개발에는 유지보수가 가장 중요한 법이니까요.</p>
<h2 id=준비하기>준비하기<a hidden class=anchor aria-hidden=true href=#준비하기>#</a></h2>
<p>우선, 우리는 스펙파일을 준비해야 합니다. 이번 포스트는 openapi v3를 기준으로 작성할것이며 v2도 전체적인 흐름은 같으니 따라해보셔도 문제가 없습니다. 먼저, 이미 스펙파일을 가지고 계신 분은 가지고 계신 스펙파일을 이용하시면되지만 저는 <a href=https://raw.githubusercontent.com/OAI/OpenAPI-Specification/master/examples/v3.0/petstore.yaml>petstore.yaml</a>을 조금 <a href=https://github.com/realsangil/swagger_file_split_example/blob/master/edited_petstore.yaml>수정한 파일</a>을 사용해 나눠보려 합니다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>openapi</span>: <span style=color:#e6db74>&#34;3.0.0&#34;</span>
<span style=color:#f92672>info</span>:
  <span style=color:#f92672>version</span>: <span style=color:#ae81ff>1.0.0</span>
  <span style=color:#f92672>title</span>: <span style=color:#ae81ff>Swagger Petstore</span>
  <span style=color:#f92672>license</span>:
    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>MIT</span>
<span style=color:#f92672>servers</span>:
  - <span style=color:#f92672>url</span>: <span style=color:#ae81ff>http://petstore.swagger.io/v1</span>
<span style=color:#f92672>paths</span>:
  <span style=color:#f92672>/pets</span>:
    <span style=color:#f92672>get</span>:
      <span style=color:#f92672>summary</span>: <span style=color:#ae81ff>List all pets</span>
      <span style=color:#f92672>operationId</span>: <span style=color:#ae81ff>listPets</span>
      <span style=color:#f92672>tags</span>:
        - <span style=color:#ae81ff>pets</span>
      <span style=color:#f92672>parameters</span>:
        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>limit</span>
          <span style=color:#f92672>in</span>: <span style=color:#ae81ff>query</span>
          <span style=color:#f92672>description</span>: <span style=color:#ae81ff>How many items to return at one time (max 100)</span>
          <span style=color:#f92672>required</span>: <span style=color:#66d9ef>false</span>
          <span style=color:#f92672>schema</span>:
            <span style=color:#f92672>type</span>: <span style=color:#ae81ff>integer</span>
            <span style=color:#f92672>format</span>: <span style=color:#ae81ff>int32</span>
      <span style=color:#f92672>responses</span>:
        <span style=color:#f92672>&#39;200&#39;</span>:
          <span style=color:#f92672>description</span>: <span style=color:#ae81ff>A paged array of pets</span>
          <span style=color:#f92672>headers</span>:
            <span style=color:#f92672>x-next</span>:
              <span style=color:#f92672>description</span>: <span style=color:#ae81ff>A link to the next page of responses</span>
              <span style=color:#f92672>schema</span>:
                <span style=color:#f92672>type</span>: <span style=color:#ae81ff>string</span>
          <span style=color:#f92672>content</span>:
            <span style=color:#f92672>application/json</span>:
              <span style=color:#f92672>schema</span>:
                <span style=color:#f92672>$ref</span>: <span style=color:#e6db74>&#34;#/components/schemas/Pets&#34;</span>
        <span style=color:#f92672>default</span>:
          <span style=color:#f92672>description</span>: <span style=color:#ae81ff>unexpected error</span>
          <span style=color:#f92672>content</span>:
            <span style=color:#f92672>application/json</span>:
              <span style=color:#f92672>schema</span>:
                <span style=color:#f92672>$ref</span>: <span style=color:#e6db74>&#34;#/components/schemas/Error&#34;</span>
    <span style=color:#f92672>post</span>:
      <span style=color:#f92672>summary</span>: <span style=color:#ae81ff>Create a pet</span>
      <span style=color:#f92672>operationId</span>: <span style=color:#ae81ff>createPets</span>
      <span style=color:#f92672>tags</span>:
        - <span style=color:#ae81ff>pets</span>
      <span style=color:#f92672>requestBody</span>:
        <span style=color:#f92672>description</span>: <span style=color:#ae81ff>unexpected error</span>
        <span style=color:#f92672>content</span>:
          <span style=color:#f92672>application/json</span>:
            <span style=color:#f92672>schema</span>:
              <span style=color:#f92672>type</span>: <span style=color:#ae81ff>object</span>
              <span style=color:#f92672>properties</span>:
                <span style=color:#f92672>name</span>:
                  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>string</span>
                <span style=color:#f92672>tags</span>:
                  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>string</span>
      <span style=color:#f92672>responses</span>:
        <span style=color:#f92672>&#39;201&#39;</span>:
          <span style=color:#f92672>description</span>: <span style=color:#ae81ff>Null response</span>
        <span style=color:#f92672>default</span>:
          <span style=color:#f92672>description</span>: <span style=color:#ae81ff>unexpected error</span>
          <span style=color:#f92672>content</span>:
            <span style=color:#f92672>application/json</span>:
              <span style=color:#f92672>schema</span>:
                <span style=color:#f92672>$ref</span>: <span style=color:#e6db74>&#34;#/components/schemas/Error&#34;</span>
  <span style=color:#ae81ff>/pets/{petId}:</span>
    <span style=color:#f92672>get</span>:
      <span style=color:#f92672>summary</span>: <span style=color:#ae81ff>Info for a specific pet</span>
      <span style=color:#f92672>operationId</span>: <span style=color:#ae81ff>showPetById</span>
      <span style=color:#f92672>tags</span>:
        - <span style=color:#ae81ff>pets</span>
      <span style=color:#f92672>parameters</span>:
        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>petId</span>
          <span style=color:#f92672>in</span>: <span style=color:#ae81ff>path</span>
          <span style=color:#f92672>required</span>: <span style=color:#66d9ef>true</span>
          <span style=color:#f92672>description</span>: <span style=color:#ae81ff>The id of the pet to retrieve</span>
          <span style=color:#f92672>schema</span>:
            <span style=color:#f92672>type</span>: <span style=color:#ae81ff>string</span>
      <span style=color:#f92672>responses</span>:
        <span style=color:#f92672>&#39;200&#39;</span>:
          <span style=color:#f92672>description</span>: <span style=color:#ae81ff>Expected response to a valid request</span>
          <span style=color:#f92672>content</span>:
            <span style=color:#f92672>application/json</span>:
              <span style=color:#f92672>schema</span>:
                <span style=color:#f92672>$ref</span>: <span style=color:#e6db74>&#34;#/components/schemas/Pet&#34;</span>
        <span style=color:#f92672>default</span>:
          <span style=color:#f92672>description</span>: <span style=color:#ae81ff>unexpected error</span>
          <span style=color:#f92672>content</span>:
            <span style=color:#f92672>application/json</span>:
              <span style=color:#f92672>schema</span>:
                <span style=color:#f92672>$ref</span>: <span style=color:#e6db74>&#34;#/components/schemas/Error&#34;</span>

    <span style=color:#f92672>put</span>:
      <span style=color:#f92672>summary</span>: <span style=color:#ae81ff>Edit a pet</span>
      <span style=color:#f92672>tags</span>:
        - <span style=color:#ae81ff>pets</span>
      <span style=color:#f92672>parameters</span>:
        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>petId</span>
          <span style=color:#f92672>in</span>: <span style=color:#ae81ff>path</span>
          <span style=color:#f92672>required</span>: <span style=color:#66d9ef>true</span>
          <span style=color:#f92672>description</span>: <span style=color:#ae81ff>The id of the pet to retrieve</span>
          <span style=color:#f92672>schema</span>:
            <span style=color:#f92672>type</span>: <span style=color:#ae81ff>string</span>
      <span style=color:#f92672>requestBody</span>:
        <span style=color:#f92672>description</span>: <span style=color:#ae81ff>unexpected error</span>
        <span style=color:#f92672>content</span>:
          <span style=color:#f92672>application/json</span>:
            <span style=color:#f92672>schema</span>:
              <span style=color:#f92672>type</span>: <span style=color:#ae81ff>object</span>
              <span style=color:#f92672>properties</span>:
                <span style=color:#f92672>name</span>:
                  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>string</span>
                <span style=color:#f92672>tags</span>:
                  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>string</span>
      <span style=color:#f92672>responses</span>:
        <span style=color:#f92672>&#39;201&#39;</span>:
          <span style=color:#f92672>description</span>: <span style=color:#ae81ff>Null response</span>
        <span style=color:#f92672>default</span>:
          <span style=color:#f92672>description</span>: <span style=color:#ae81ff>unexpected error</span>
          <span style=color:#f92672>content</span>:
            <span style=color:#f92672>application/json</span>:
              <span style=color:#f92672>schema</span>:
                <span style=color:#f92672>$ref</span>: <span style=color:#e6db74>&#34;#/components/schemas/Error&#34;</span>
<span style=color:#f92672>components</span>:
  <span style=color:#f92672>schemas</span>:
    <span style=color:#f92672>Pet</span>:
      <span style=color:#f92672>required</span>:
        - <span style=color:#ae81ff>id</span>
        - <span style=color:#ae81ff>name</span>
      <span style=color:#f92672>properties</span>:
        <span style=color:#f92672>id</span>:
          <span style=color:#f92672>type</span>: <span style=color:#ae81ff>integer</span>
          <span style=color:#f92672>format</span>: <span style=color:#ae81ff>int64</span>
        <span style=color:#f92672>name</span>:
          <span style=color:#f92672>type</span>: <span style=color:#ae81ff>string</span>
        <span style=color:#f92672>tags</span>:
          <span style=color:#f92672>type</span>: <span style=color:#ae81ff>string</span>
    <span style=color:#f92672>Pets</span>:
      <span style=color:#f92672>type</span>: <span style=color:#ae81ff>array</span>
      <span style=color:#f92672>items</span>:
        <span style=color:#f92672>$ref</span>: <span style=color:#e6db74>&#34;#/components/schemas/Pet&#34;</span>
    <span style=color:#f92672>Error</span>:
      <span style=color:#f92672>required</span>:
        - <span style=color:#ae81ff>code</span>
        - <span style=color:#ae81ff>message</span>
      <span style=color:#f92672>properties</span>:
        <span style=color:#f92672>code</span>:
          <span style=color:#f92672>type</span>: <span style=color:#ae81ff>integer</span>
          <span style=color:#f92672>format</span>: <span style=color:#ae81ff>int32</span>
        <span style=color:#f92672>message</span>:
          <span style=color:#f92672>type</span>: <span style=color:#ae81ff>string</span>
</code></pre></div><p>우선 <code>edited_petstore.yaml</code>파일을 보시면 한번이라도 swagger를 사용해보신 분이라면 이정도 스펙파일은 길지 않다는 걸 잘 알고 계실 겁니다.</p>
<p>이미 <code>$ref</code>를 사용해 <code>schema</code>들을 모듈화해서 중복을 최대한 줄이려고 했습니다만.
중복되는 부분이 세개가 보이네요.</p>
<ol>
<li><code>POST /pets</code>와 <code>PUT /pets/{pet_id}</code>의 <code>requestBody</code></li>
<li><code>GET /pets/{pet_id}</code>와 <code>PUT /pets/{pet_id}</code>의 <code>pet_id</code> 파라메터</li>
<li>반복되는 <code>response</code>의 <code>unexpected error</code></li>
</ol>
<p>저는 이 두개의 중복과 스키마, 그리고 엔드포인트들을 파일로 나눠보려 합니다.</p>
<h3 id=1-requestbody-분리하기>1. requestBody 분리하기<a hidden class=anchor aria-hidden=true href=#1-requestbody-분리하기>#</a></h3>
<p>중복되는 <code>requestBody</code>를 <code>requestBodies/pet.yaml</code> 파일로 옮겨보겠습니다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#75715e># requestBodies/pet.yaml</span>
<span style=color:#f92672>description</span>: <span style=color:#e6db74>&#39;pet create/edit request&#39;</span>
<span style=color:#f92672>content</span>:
  <span style=color:#f92672>application/json</span>:
    <span style=color:#f92672>schema</span>:
      <span style=color:#f92672>type</span>: <span style=color:#ae81ff>object</span>
      <span style=color:#f92672>properties</span>:
        <span style=color:#f92672>name</span>:
          <span style=color:#f92672>type</span>: <span style=color:#ae81ff>string</span>
        <span style=color:#f92672>tags</span>:
          <span style=color:#f92672>type</span>: <span style=color:#ae81ff>string</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#75715e># swagger.yaml</span>
<span style=color:#f92672>/pets</span>:
    <span style=color:#f92672>post</span>:
      <span style=color:#f92672>summary</span>: <span style=color:#ae81ff>Create a pet</span>
      <span style=color:#f92672>operationId</span>: <span style=color:#ae81ff>createPets</span>
      <span style=color:#f92672>tags</span>:
        - <span style=color:#ae81ff>pets</span>
      <span style=color:#f92672>requestBody</span>:
				<span style=color:#f92672>$ref</span>: <span style=color:#e6db74>&#39;requestBodies/pet.yaml&#39;</span>
      <span style=color:#f92672>responses</span>:
        <span style=color:#f92672>&#39;201&#39;</span>:
          <span style=color:#f92672>description</span>: <span style=color:#ae81ff>Null response</span>
        <span style=color:#f92672>default</span>:
          <span style=color:#f92672>description</span>: <span style=color:#ae81ff>unexpected error</span>
          <span style=color:#f92672>content</span>:
            <span style=color:#f92672>application/json</span>:
              <span style=color:#f92672>schema</span>:
                <span style=color:#f92672>$ref</span>: <span style=color:#e6db74>&#34;#/components/schemas/Error&#34;</span>
  <span style=color:#ae81ff>/pets/{petId}:</span>
    <span style=color:#f92672>put</span>:
      <span style=color:#f92672>summary</span>: <span style=color:#ae81ff>Edit a pet</span>
      <span style=color:#f92672>tags</span>:
        - <span style=color:#ae81ff>pets</span>
      <span style=color:#f92672>parameters</span>:
        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>petId</span>
          <span style=color:#f92672>in</span>: <span style=color:#ae81ff>path</span>
          <span style=color:#f92672>required</span>: <span style=color:#66d9ef>true</span>
          <span style=color:#f92672>description</span>: <span style=color:#ae81ff>The id of the pet to retrieve</span>
          <span style=color:#f92672>schema</span>:
            <span style=color:#f92672>type</span>: <span style=color:#ae81ff>string</span>
      <span style=color:#f92672>requestBody</span>:
        <span style=color:#f92672>$ref</span>: <span style=color:#e6db74>&#39;requestBodies/pet.yaml&#39;</span>
      <span style=color:#f92672>responses</span>:
        <span style=color:#f92672>&#39;201&#39;</span>:
          <span style=color:#f92672>description</span>: <span style=color:#ae81ff>Null response</span>
        <span style=color:#f92672>default</span>:
          <span style=color:#f92672>description</span>: <span style=color:#ae81ff>unexpected error</span>
          <span style=color:#f92672>content</span>:
            <span style=color:#f92672>application/json</span>:
              <span style=color:#f92672>schema</span>:
                <span style=color:#f92672>$ref</span>: <span style=color:#e6db74>&#34;#/components/schemas/Error&#34;</span>
</code></pre></div><p>위 처럼 나눈 파일을 봤을때 주의해야할 것이 <code>requestBody</code>에 있는 <code>$ref</code>입니다.
<code>$ref</code>는 <code>swagger.yaml</code>의 위치를 기준으로 relative path로 <code>pet.yaml</code> 파일을 찾습니다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>.
├── requestBodies
│   └── pet.yaml
└── swagger.yaml
</code></pre></div><p>파일을 나눈 후 위와같은 폴더 구조를 갖습니다.</p>
<h3 id=2-parameter-분리하기>2. parameter 분리하기<a hidden class=anchor aria-hidden=true href=#2-parameter-분리하기>#</a></h3>
<p>이번에는 중복되는 parameter인 <code>petId</code>를 분리 해보겠습니다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#75715e># parameter.yaml</span>
<span style=color:#f92672>queryPetId</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>petId</span>
  <span style=color:#f92672>in</span>: <span style=color:#ae81ff>path</span>
  <span style=color:#f92672>required</span>: <span style=color:#66d9ef>true</span>
  <span style=color:#f92672>description</span>: <span style=color:#ae81ff>The id of the pet to retrieve</span>
  <span style=color:#f92672>schema</span>:
    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>string</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#75715e># swagger.yaml</span>
<span style=color:#ae81ff>/pets/{petId}:</span>
    <span style=color:#f92672>get</span>:
      <span style=color:#f92672>summary</span>: <span style=color:#ae81ff>Info for a specific pet</span>
      <span style=color:#f92672>operationId</span>: <span style=color:#ae81ff>showPetById</span>
      <span style=color:#f92672>tags</span>:
        - <span style=color:#ae81ff>pets</span>
      <span style=color:#f92672>parameters</span>:
        - <span style=color:#f92672>$ref</span>: <span style=color:#e6db74>&#39;parameters.yaml#/queryPetId&#39;</span>
      <span style=color:#f92672>responses</span>:
        <span style=color:#f92672>&#39;200&#39;</span>:
          <span style=color:#f92672>description</span>: <span style=color:#ae81ff>Expected response to a valid request</span>
          <span style=color:#f92672>content</span>:
            <span style=color:#f92672>application/json</span>:
              <span style=color:#f92672>schema</span>:
                <span style=color:#f92672>$ref</span>: <span style=color:#e6db74>&#34;#/components/schemas/Pet&#34;</span>
        <span style=color:#f92672>default</span>:
          <span style=color:#f92672>description</span>: <span style=color:#ae81ff>unexpected error</span>
          <span style=color:#f92672>content</span>:
            <span style=color:#f92672>application/json</span>:
              <span style=color:#f92672>schema</span>:
                <span style=color:#f92672>$ref</span>: <span style=color:#e6db74>&#34;#/components/schemas/Error&#34;</span>

    <span style=color:#f92672>put</span>:
      <span style=color:#f92672>summary</span>: <span style=color:#ae81ff>Edit a pet</span>
      <span style=color:#f92672>tags</span>:
        - <span style=color:#ae81ff>pets</span>
      <span style=color:#f92672>parameters</span>:
        - <span style=color:#f92672>$ref</span>: <span style=color:#e6db74>&#39;parameters.yaml#/queryPetId&#39;</span>
      <span style=color:#f92672>requestBody</span>:
        <span style=color:#f92672>$ref</span>: <span style=color:#e6db74>&#39;requestBodies/pet.yaml&#39;</span>
      <span style=color:#f92672>responses</span>:
        <span style=color:#f92672>&#39;201&#39;</span>:
          <span style=color:#f92672>description</span>: <span style=color:#ae81ff>Null response</span>
        <span style=color:#f92672>default</span>:
          <span style=color:#f92672>description</span>: <span style=color:#ae81ff>unexpected error</span>
          <span style=color:#f92672>content</span>:
            <span style=color:#f92672>application/json</span>:
              <span style=color:#f92672>schema</span>:
                <span style=color:#f92672>$ref</span>: <span style=color:#e6db74>&#34;#/components/schemas/Error&#34;</span>
</code></pre></div><p>위와 같이 파일을 분리하였고 아래와 같은 폴더 구조가 되었습니다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>.
├── parameters.yaml
├── requestBodies
│   └── pet.yaml
└── swagger.yaml
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>parameters</span>:
	- <span style=color:#f92672>$ref</span>: <span style=color:#e6db74>&#39;parameters.yaml#/queryPetId&#39;</span>
</code></pre></div><p>이번 <code>$ref</code>는 좀 다르게 생겼습니다. 파일을 링크하긴 하지만 뒤에 <code>#/queryPetId</code>가 붙었습니다.
이 표현은 한 파일 안에 다수의 파라메터들이 적용되었을 때 특정 파라메터를 참조하고 싶을 때 사용할 수 있는 표현입니다. 이 표현은 <code>parameter</code>에만 한정된 것이 아니고 <code>requestBody</code>, <code>response</code>, <code>schema</code>에도 사용할 수 있습니다.</p>
<h3 id=3-중복된-response-분리하기>3. 중복된 response 분리하기<a hidden class=anchor aria-hidden=true href=#3-중복된-response-분리하기>#</a></h3>
<p>이번에는 <code>response</code>에서 계속 반복되던 <code>unexpect error</code> 부분을 수정해보겠습니다.
이 때 <code>components/schemas</code>에 있는 <code>schema</code>들도 함께 파일로 분리해보겠습니다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#75715e># responses/unexpected_error.yaml</span>
<span style=color:#f92672>description</span>: <span style=color:#ae81ff>unexpected error</span>
<span style=color:#f92672>content</span>:
  <span style=color:#f92672>application/json</span>:
    <span style=color:#f92672>schema</span>:
      <span style=color:#f92672>$ref</span>: <span style=color:#e6db74>&#34;#/components/schemas/Error&#34;</span>
</code></pre></div><p>먼저 손쉽게 error를 분리했습니다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#75715e># schemas.yaml</span>
<span style=color:#f92672>Pet</span>:
  <span style=color:#f92672>required</span>:
    - <span style=color:#ae81ff>id</span>
    - <span style=color:#ae81ff>name</span>
  <span style=color:#f92672>properties</span>:
    <span style=color:#f92672>id</span>:
      <span style=color:#f92672>type</span>: <span style=color:#ae81ff>integer</span>
      <span style=color:#f92672>format</span>: <span style=color:#ae81ff>int64</span>
    <span style=color:#f92672>name</span>:
      <span style=color:#f92672>type</span>: <span style=color:#ae81ff>string</span>
    <span style=color:#f92672>tags</span>:
      <span style=color:#f92672>type</span>: <span style=color:#ae81ff>string</span>
<span style=color:#f92672>Pets</span>:
  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>array</span>
  <span style=color:#f92672>items</span>:
    <span style=color:#f92672>$ref</span>: <span style=color:#e6db74>&#34;schemas.yaml#/Pet&#34;</span>
<span style=color:#f92672>Error</span>:
  <span style=color:#f92672>required</span>:
    - <span style=color:#ae81ff>code</span>
    - <span style=color:#ae81ff>message</span>
  <span style=color:#f92672>properties</span>:
    <span style=color:#f92672>code</span>:
      <span style=color:#f92672>type</span>: <span style=color:#ae81ff>integer</span>
      <span style=color:#f92672>format</span>: <span style=color:#ae81ff>int32</span>
    <span style=color:#f92672>message</span>:
      <span style=color:#f92672>type</span>: <span style=color:#ae81ff>string</span>
</code></pre></div><p>그다음 위와 같이 <code>schemas.yaml</code>을 분리하고 <code>components</code>를 삭제했습니다. 이때 <code>Error</code>를 찾지 못해서 에러가 발생합니다. 이유는 <code>components/schemas</code>들을 모두 삭제해서 찾을 수 없기 때문이죠.
이때 파일간의 참조는 어떻게 하는지 배울 수 있습니다.</p>
<p>분리한 <code># responses/unexpected_error.yaml</code> 아래와 같이 수정하겠습니다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#75715e># responses/unexpected_error.yaml</span>
<span style=color:#f92672>description</span>: <span style=color:#ae81ff>unexpected error</span>
<span style=color:#f92672>content</span>:
  <span style=color:#f92672>application/json</span>:
    <span style=color:#f92672>schema</span>:
      <span style=color:#f92672>$ref</span>: <span style=color:#e6db74>&#34;../schemas.yaml#/Error&#34;</span>
</code></pre></div><p>수정한 파일 내용을 보면 <code>swagger.yaml</code>가 다른 파일을 참조할 때처럼
<code>responses/unexpected_error.yaml</code>을 기준으로 <code>schemas.yaml</code>을 참조하시면 됩니다.</p>
<p>위와 같이 수정하고 나면 최종적으로 <code>swagger.yaml</code>는 아래와 같은 형태를 띄게 됩니다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#75715e># swagger.yaml</span>
<span style=color:#f92672>openapi</span>: <span style=color:#e6db74>&#34;3.0.0&#34;</span>
<span style=color:#f92672>info</span>:
  <span style=color:#f92672>version</span>: <span style=color:#ae81ff>1.0.0</span>
  <span style=color:#f92672>title</span>: <span style=color:#ae81ff>Swagger Petstore</span>
  <span style=color:#f92672>license</span>:
    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>MIT</span>
<span style=color:#f92672>servers</span>:
  - <span style=color:#f92672>url</span>: <span style=color:#ae81ff>http://petstore.swagger.io/v1</span>
<span style=color:#f92672>paths</span>:
  <span style=color:#f92672>/pets</span>:
    <span style=color:#f92672>get</span>:
      <span style=color:#f92672>summary</span>: <span style=color:#ae81ff>List all pets</span>
      <span style=color:#f92672>operationId</span>: <span style=color:#ae81ff>listPets</span>
      <span style=color:#f92672>tags</span>:
        - <span style=color:#ae81ff>pets</span>
      <span style=color:#f92672>parameters</span>:
        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>limit</span>
          <span style=color:#f92672>in</span>: <span style=color:#ae81ff>query</span>
          <span style=color:#f92672>description</span>: <span style=color:#ae81ff>How many items to return at one time (max 100)</span>
          <span style=color:#f92672>required</span>: <span style=color:#66d9ef>false</span>
          <span style=color:#f92672>schema</span>:
            <span style=color:#f92672>type</span>: <span style=color:#ae81ff>integer</span>
            <span style=color:#f92672>format</span>: <span style=color:#ae81ff>int32</span>
      <span style=color:#f92672>responses</span>:
        <span style=color:#f92672>&#39;200&#39;</span>:
          <span style=color:#f92672>description</span>: <span style=color:#ae81ff>A paged array of pets</span>
          <span style=color:#f92672>content</span>:
            <span style=color:#f92672>application/json</span>:
              <span style=color:#f92672>schema</span>:
                <span style=color:#f92672>$ref</span>: <span style=color:#e6db74>&#34;schemas.yaml#/Pets&#34;</span>
        <span style=color:#f92672>default</span>:
          <span style=color:#f92672>$ref</span>: <span style=color:#e6db74>&#39;responses/unexpected_error.yaml&#39;</span>
    <span style=color:#f92672>post</span>:
      <span style=color:#f92672>summary</span>: <span style=color:#ae81ff>Create a pet</span>
      <span style=color:#f92672>operationId</span>: <span style=color:#ae81ff>createPets</span>
      <span style=color:#f92672>tags</span>:
        - <span style=color:#ae81ff>pets</span>
      <span style=color:#f92672>requestBody</span>:
        <span style=color:#f92672>$ref</span>: <span style=color:#e6db74>&#39;requestBodies/pet.yaml&#39;</span>
      <span style=color:#f92672>responses</span>:
        <span style=color:#f92672>&#39;201&#39;</span>:
          <span style=color:#f92672>description</span>: <span style=color:#ae81ff>Null response</span>
        <span style=color:#f92672>default</span>:
          <span style=color:#f92672>$ref</span>: <span style=color:#e6db74>&#39;responses/unexpected_error.yaml&#39;</span>
  <span style=color:#ae81ff>/pets/{petId}:</span>
    <span style=color:#f92672>get</span>:
      <span style=color:#f92672>summary</span>: <span style=color:#ae81ff>Info for a specific pet</span>
      <span style=color:#f92672>operationId</span>: <span style=color:#ae81ff>showPetById</span>
      <span style=color:#f92672>tags</span>:
        - <span style=color:#ae81ff>pets</span>
      <span style=color:#f92672>parameters</span>:
        - <span style=color:#f92672>$ref</span>: <span style=color:#e6db74>&#39;parameters.yaml#/queryPetId&#39;</span>
      <span style=color:#f92672>responses</span>:
        <span style=color:#f92672>&#39;200&#39;</span>:
          <span style=color:#f92672>description</span>: <span style=color:#ae81ff>Expected response to a valid request</span>
          <span style=color:#f92672>content</span>:
            <span style=color:#f92672>application/json</span>:
              <span style=color:#f92672>schema</span>:
                <span style=color:#f92672>$ref</span>: <span style=color:#e6db74>&#34;schemas.yaml#/Pet&#34;</span>
        <span style=color:#f92672>default</span>:
          <span style=color:#f92672>$ref</span>: <span style=color:#e6db74>&#39;responses/unexpected_error.yaml&#39;</span>

    <span style=color:#f92672>put</span>:
      <span style=color:#f92672>summary</span>: <span style=color:#ae81ff>Edit a pet</span>
      <span style=color:#f92672>tags</span>:
        - <span style=color:#ae81ff>pets</span>
      <span style=color:#f92672>parameters</span>:
        - <span style=color:#f92672>$ref</span>: <span style=color:#e6db74>&#39;parameters.yaml#/queryPetId&#39;</span>
      <span style=color:#f92672>requestBody</span>:
        <span style=color:#f92672>$ref</span>: <span style=color:#e6db74>&#39;requestBodies/pet.yaml&#39;</span>
      <span style=color:#f92672>responses</span>:
        <span style=color:#f92672>&#39;201&#39;</span>:
          <span style=color:#f92672>description</span>: <span style=color:#ae81ff>Null response</span>
        <span style=color:#f92672>default</span>:
          <span style=color:#f92672>$ref</span>: <span style=color:#e6db74>&#39;responses/unexpected_error.yaml&#39;</span>
</code></pre></div><p>그리고 아래와 같은 형태의 디렉토리 구조가 됩니다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>.
├── parameters.yaml
├── requestBodies
│   └── pet.yaml
├── responses
│   └── unexpected_error.yaml
├── schemas.yaml
└── swagger.yaml
</code></pre></div><h2 id=요약>요약<a hidden class=anchor aria-hidden=true href=#요약>#</a></h2>
<ul>
<li><code>$ref</code>를 이용하여 스펙파일을 모듈화하면 유지보수가 용이해진다.</li>
<li>참조
<ul>
<li>파일 참조는 <code>$ref</code>를 사용한다.</li>
<li>파일간의 참조는 현재 파일 위치를 기준으로 참조할 파일의 relative path를 사용하면 된다.</li>
</ul>
</li>
</ul>
<h2 id=마치며>마치며&mldr;<a hidden class=anchor aria-hidden=true href=#마치며>#</a></h2>
<p>위의 예제들을 보면 두서없이 파일을 나눈것 처럼 보입니다. 이것은 단지 독자들에게 다양한 형태의 참조를 보여드리기 위해서 이런 형태를 만들어 보았습니다. 물론 실제로 사용할 때는 좀 더 일관성 있는 형태의 구조로 사용하는 것이 좋습니다.</p>
<p>위의 예제들은 <a href=https://github.com/realsangil/swagger_file_split_example>이곳</a>에 업로드 했으니 참조하시면 될 것 같습니다.</p>
<h3 id=추가적인-팁>추가적인 팁<a hidden class=anchor aria-hidden=true href=#추가적인-팁>#</a></h3>
<p>저는 이렇게 만든 파일들을 배포할 때는 전체 파일을 배포하기보다는 하나의 파일로 묶어서 배포합니다.
이때 사용할 수 있는게 <code>openapi-generator</code>입니다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>openapi-generator generate -i ./swagger.yaml -g openapi-yaml -o compiled
</code></pre></div><p>위의 커맨드를 사용하게 되면 나눠져 있던 파일들을 모아서 우리가 처음에 나누지 않았던 형태의 파일처럼 하나로 합쳐주게 됩니다.</p>
<p>자세한 설치방법과 사용법은 (openapi-generator)[https://github.com/OpenAPITools/openapi-generator] 를 참조하시면 될 것 같습니다.</p>
<h2 id=reference>Reference<a hidden class=anchor aria-hidden=true href=#reference>#</a></h2>
<ul>
<li><a href=https://swagger.io/docs/specification/using-ref>https://swagger.io/docs/specification/using-ref</a></li>
</ul>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://blog.realsangil.net/tags/openapi/>openapi</a></li>
<li><a href=https://blog.realsangil.net/tags/documentation/>documentation</a></li>
</ul>
<nav class=paginav>
<a class=prev href=https://blog.realsangil.net/posts/2020-01-30-summarize-opensource-license/>
<span class=title>« Prev Page</span>
<br>
<span>OpenSource 라이센스 간단 정리</span>
</a>
<a class=next href=https://blog.realsangil.net/posts/2018-10-31-letsencrypt-wildcard-certification-renew/>
<span class=title>Next Page »</span>
<br>
<span>Let's Encrypt 와일드카드 인증서 갱신해보기</span>
</a>
</nav>
</footer><script src=https://utteranc.es/client.js repo=realsangil/realsangil.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script>
</article>
</main>
<footer class=footer>
<span>&copy; 2021 <a href=https://blog.realsangil.net>Realsangil</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>